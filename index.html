<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>IndaiaFibra - Avalia√ß√£o</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    html, body {
      margin: 0;
      height: 100%;
      overflow: hidden;
      font-family: 'Poppins', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      background: black;
      color: white;
    }

    #spaceCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at center, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
      z-index: 0;
      transition: transform 8s cubic-bezier(0.2, 0.8, 0.2, 1);
    }

    .nebula {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 30%, rgba(100, 150, 255, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 70%, rgba(255, 100, 150, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 50% 10%, rgba(150, 100, 255, 0.2) 0%, transparent 60%);
      z-index: 1;
      opacity: 0.6;
      animation: nebulaPulse 20s ease-in-out infinite;
    }

    .hyperdrive {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        linear-gradient(to bottom, rgba(32, 41, 158, 0.6) 0%, rgba(255, 255, 255, 0.15) 50%, rgba(179, 14, 14, 0.95) 100%),
        repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.05) 10px, rgba(255,255,255,0.05) 20px);
      opacity: 0;
      z-index: 2;
      pointer-events: none;
      transition: opacity 0.5s ease-in;
    }

    img {
      width: 150px;
      transform: translateY(100vh) scale(0.7);
      animation: entradaLogo 3.5s cubic-bezier(0.25, 0.8, 0.25, 1) forwards;
      filter: drop-shadow(0 0 30px rgba(21, 94, 183, 1)) brightness(1.5) saturate(2.0) contrast(1.2);
      z-index: 5;
      position: relative;
      cursor: pointer; /* Adicionado para indicar que o logo √© clic√°vel */
      transition: transform 0.2s ease; /* Suave hover no logo */
    }

    img:hover {
      transform: scale(1.05); /* Efeito de hover no logo */
    }

    .flare {
      position: absolute;
      width: 200px;
      height: 200px;
      background: 
        radial-gradient(circle, rgba(255, 255, 255, 0.9) 0%, rgba(255, 200, 100, 0.6) 30%, transparent 70%),
        radial-gradient(ellipse, rgba(100, 200, 255, 0.4) 0%, transparent 50%);
      opacity: 0;
      z-index: 4;
      animation: flareEffect 0.5s ease-out forwards;
      pointer-events: none;
      border-radius: 50%;
    }

    p {
      font-size: 1.6rem;
      margin: 10px 0;
      opacity: 0;
      z-index: 5;
      position: relative;
      letter-spacing: 2px;
      text-align: center;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
    }

    #text1 { animation: textoAparece 1.5s ease-out 2.5s forwards; }
    #text2 { animation: textoAparece 1.5s ease-out 3.9s forwards; font-size: 2rem; font-weight: 700; text-shadow: 0 0 20px rgba(21, 94, 183, 0.8); }

    .button-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      margin-top: 20px;
      opacity: 0;
      animation: textoAparece 1.5s ease-out 4.5s forwards;
      z-index: 5;
    }

    button {
      padding: 12px 24px;
      font-size: 1.2rem;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      background: linear-gradient(45deg, #155EB7, #0d47a1);
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(21, 94, 183, 0.3), inset 0 1px 0 rgba(255,255,255,0.2);
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      min-width: 200px;
      position: relative;
      overflow: hidden;
    }

    /* Estilo espec√≠fico para o bot√£o de gorjeta - mais simples e acolhedor */
    #tipButton {
      background: linear-gradient(45deg, #ffc107, #ff9800);
      box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-weight: 700;
      letter-spacing: 0.5px;
    }

    #tipButton:hover {
      box-shadow: 0 8px 25px rgba(255, 193, 7, 0.4);
      transform: translateY(-2px) scale(1.05);
    }

    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    button:hover::before {
      left: 100%;
    }

    button:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 8px 25px rgba(21, 94, 183, 0.4), inset 0 1px 0 rgba(255,255,255,0.3);
    }

    button:active {
      transform: translateY(0) scale(0.98);
    }

    #evaluateButton {
      background: linear-gradient(45deg, #28a745, #20c997);
      box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
    }

    #evaluateButton:hover {
      box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
    }

    #playButton {
      display: none; /* Bot√£o "Jogar" oculto permanentemente */
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(221, 221, 221, 1);
      opacity: 0;
      z-index: 10;
      pointer-events: none;
      transition: opacity 1s ease-in;
    }

    #gameOverOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at center, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.95) 100%),
        url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><radialGradient id="g" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="%23ff0000" stop-opacity="0.1"/><stop offset="100%" stop-color="%23ff0000" stop-opacity="0"/></radialGradient></defs><circle cx="50" cy="50" r="50" fill="url(%23g)"/></svg>') center/cover;
      z-index: 20;
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      color: white;
      font-family: 'Poppins', sans-serif;
      gap: 20px;
      text-align: center;
      padding: 20px;
      opacity: 0;
      transition: opacity 0.8s ease-out;
    }

    #gameOverOverlay h2 {
      font-size: 2.5rem;
      margin: 0 0 10px;
      font-weight: 700;
      text-shadow: 0 0 20px rgba(255,0,0,0.8);
      letter-spacing: 2px;
      opacity: 0;
      transform: scale(0.8);
      transition: all 0.6s ease-out;
    }

    #gameOverOverlay p {
      font-size: 1.8rem;
      margin: 0 0 20px;
      text-shadow: 0 0 10px rgba(255,255,255,0.5);
      opacity: 0;
      transform: scale(0.5);
      transition: all 0.8s ease-out;
    }

    #gameOverOverlay.show h2,
    #gameOverOverlay.show p {
      opacity: 1;
      transform: scale(1);
    }

    .score {
      color: #FFD700;
      text-shadow: 0 0 15px #FFD700;
      font-weight: 700;
      font-size: 1.2em;
    }

    #top5 {
      list-style: none;
      padding: 0;
      margin: 10px 0;
      max-width: 300px;
      opacity: 0;
      transform: translateY(30px);
      transition: all 0.5s ease-out;
    }

    #top5 li {
      font-size: 1.2rem;
      margin: 8px 0;
      padding: 5px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      text-align: left;
      text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
      opacity: 0;
      transform: translateX(-30px) translateY(20px);
      transition: all 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    #top5.animate-ranking {
      opacity: 1;
      transform: translateY(0);
    }

    #top5.animate-ranking li:nth-child(1) {
      transition-delay: 0.2s;
      opacity: 1;
      transform: translateX(0) translateY(0);
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
    }

    #top5.animate-ranking li:nth-child(2) {
      transition-delay: 0.3s;
      opacity: 1;
      transform: translateX(0) translateY(0);
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
    }

    #top5.animate-ranking li:nth-child(3) {
      transition-delay: 0.4s;
      opacity: 1;
      transform: translateX(0) translateY(0);
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
    }

    #top5.animate-ranking li:nth-child(4) {
      transition-delay: 0.5s;
      opacity: 1;
      transform: translateX(0) translateY(0);
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
    }

    #top5.animate-ranking li:nth-child(5) {
      transition-delay: 0.6s;
      opacity: 1;
      transform: translateX(0) translateY(0);
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
    }

    #top5 li:nth-child(1)::before {
      content: 'ü•á ';
      font-size: 1.1em;
    }

    #top5 li:nth-child(2)::before {
      content: 'ü•à ';
      font-size: 1.1em;
    }

    #top5 li:nth-child(3)::before {
      content: 'ü•â ';
      font-size: 1.1em;
    }

    #nameInput {
      display: none;
      flex-direction: column;
      gap: 10px;
      margin: 10px 0;
    }

    #nameInput input {
      padding: 10px;
      font-size: 1rem;
      border: none;
      border-radius: 15px;
      width: 200px;
      max-width: 80%;
      background: rgba(255, 255, 255, 0.9);
      color: black;
      font-family: 'Poppins', sans-serif;
    }

    #nameInput button {
      padding: 10px 20px;
      font-size: 1rem;
      min-width: auto;
      width: auto;
    }

    .success-message {
      opacity: 0;
      transform: scale(0.8);
      transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
      color: #00ff00;
      font-size: 1.2rem;
      font-weight: 600;
      text-align: center;
      text-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
      margin: 10px 0;
    }

    .success-message.show {
      opacity: 1;
      transform: scale(1);
    }

    #gameOverOverlay button {
      padding: 12px 24px;
      font-size: 1.1rem;
      font-weight: 600;
      background: linear-gradient(45deg, #155EB7, #0d47a1);
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      margin: 0 5px;
      min-width: auto;
      box-shadow: 0 4px 15px rgba(21, 94, 183, 0.3);
      transition: all 0.3s ease;
      opacity: 0;
      transform: translateY(20px);
    }

    #gameOverOverlay.show button {
      opacity: 1;
      transform: translateY(0);
      transition-delay: 0.8s;
    }

    #gameOverOverlay button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(21, 94, 183, 0.4);
    }

    #gameOverOverlay button:nth-child(3) {
      background: linear-gradient(45deg, #6c757d, #495057);
      box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
    }

    #gameOverOverlay button:nth-child(3):hover {
      box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
    }

    #gameOverOverlay button:nth-child(4) {
      background: linear-gradient(45deg, #28a745, #20c997);
      box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
    }

    #gameOverOverlay button:nth-child(4):hover {
      box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
    }

    @media (max-width: 768px) {
      .button-container {
        flex-direction: column;
        gap: 10px;
      }

      button {
        font-size: 1.4rem;
        padding: 15px 30px;
        min-width: 250px;
      }

      #playButton {
        display: none; /* Mantido oculto em mobile tamb√©m */
      }

      #tipButton {
        font-size: 1.4rem;
        padding: 15px 30px;
        min-width: 250px;
      }

      #gameOverOverlay button {
        font-size: 1.3rem;
        padding: 15px 30px;
        margin: 5px 0;
        width: 80%;
      }

      #gameOverOverlay {
        gap: 15px;
        padding: 10px;
      }

      #gameOverOverlay h2 {
        font-size: 2rem;
      }

      #gameOverOverlay p {
        font-size: 1.5rem;
      }

      #top5 li {
        font-size: 1.1rem;
      }

      #nameInput input {
        width: 250px;
        max-width: 90%;
      }

      .success-message {
        font-size: 1.4rem;
      }

      img:hover {
        transform: scale(1.1); /* Ajuste para mobile */
      }
    }

    .rastro {
      position: absolute;
      width: 100px;
      height: 350px;
      background: linear-gradient(to top, rgba(255, 230, 100, 0), rgba(0, 139, 255, 0.8), rgba(255, 50, 50, 1));
      border-radius: 100px 100px 50px 50px;
      filter: blur(120px);
      z-index: 6;
      opacity: 1;
      animation: pulsoRastro 1s ease-in-out infinite;
      pointer-events: none;
    }

    .rastro-core {
      position: absolute;
      width: 20px;
      height: 300px;
      background: linear-gradient(to top, rgba(50, 194, 255, 0.79), rgba(255, 4, 4, 1));
      border-radius: 40px;
      filter: blur(40px);
      z-index: 6;
      opacity: 1;
      animation: pulsoRastroCore 0.5s ease-in-out infinite;
      pointer-events: none;
    }

    /* Estilos para o Modal de T√©cnicos (scroll lateral) */
    .technicians-modal {
      display: none;
      position: fixed;
      z-index: 30;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
      animation: fadeIn 0.3s ease-out;
    }

    .technicians-modal-content {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      margin: 10% auto;
      padding: 30px;
      border-radius: 20px;
      width: 90%;
      max-width: 800px;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.1);
      animation: slideIn 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      position: absolute;
      right: 20px;
      top: 15px;
      transition: all 0.3s ease;
      z-index: 5;
    }

    .close:hover,
    .close:focus {
      color: white;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
      transform: scale(1.1);
    }

    .technicians-modal h2 {
      text-align: center;
      margin-bottom: 10px;
      font-size: 1.8rem;
      color: white;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
      letter-spacing: 1px;
    }

    .technicians-modal p {
      text-align: center;
      color: #ccc;
      margin-bottom: 20px;
      font-size: 1.1rem;
    }

    .pix-buttons {
      display: flex;
      flex-direction: row;
      overflow-x: auto;
      gap: 10px;
      margin-top: 10px;
      width: 100%;
      height: auto;
      padding: 10px 0;
      scrollbar-width: thin;
      scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
    }

    .pix-buttons::-webkit-scrollbar {
      height: 6px;
    }

    .pix-buttons::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.5);
      border-radius: 3px;
    }

    .pix-buttons::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.3);
      border-radius: 3px;
    }

    .pix-buttons::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.5);
    }

    .pix-button {
      background: linear-gradient(45deg, #28a745, #20c997);
      box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      min-width: 180px;
      flex-shrink: 0;
      white-space: nowrap;
      padding: 12px 16px;
      border-radius: 20px;
      font-size: 1.1rem;
      font-weight: 600;
      color: white;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .pix-button:hover,
    .pix-button.selected {
      box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
      transform: translateY(-2px) scale(1.05);
      background: linear-gradient(45deg, #20c997, #28a745);
    }

    .selected-key {
      margin-top: 20px;
      width: 100%;
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      animation: slideIn 0.3s ease-out;
    }

    .selected-key.show {
      display: flex;
    }

    .pix-key-display {
      background: rgba(0, 0, 0, 0.5);
      padding: 10px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 1rem;
      color: #00ff00;
      word-break: break-all;
      text-align: center;
      border: 1px solid rgba(0, 255, 0, 0.3);
      width: 100%;
      max-width: 300px;
    }

    .gratitude-message {
      font-style: italic;
      color: #ffd700;
      text-align: center;
      margin-top: 5px;
      font-size: 0.9rem;
    }

    /* Container para a notifica√ß√£o com logo voando */
    .notification-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 100;
      display: none;
      justify-content: center;
      align-items: center;
      pointer-events: none;
    }

    .notification-container.show {
      display: flex;
    }

    /* Fundo escuro borrado durante a exibi√ß√£o da mensagem */
    .notification-backdrop {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    .notification-backdrop.show {
      opacity: 1;
    }

    /* Logo voando na notifica√ß√£o - posicionado mais acima */
    .notification-logo {
      position: absolute;
      top: 25%; /* Posicionado mais acima da mensagem (que est√° em ~50%) */
      left: 50%;
      transform: translateX(-50%) translateY(100vh) scale(0.7);
      width: 150px;
      filter: drop-shadow(0 0 30px rgba(21, 94, 183, 1)) brightness(1.5) saturate(2.0) contrast(1.2);
      z-index: 101;
      opacity: 0;
    }

    /* Anima√ß√£o ajustada para o logo na notifica√ß√£o */
    @keyframes notificationLogoEntrance {
      0% { 
        transform: translateX(-50%) translateY(100vh) scale(0.7); 
        opacity: 0; 
      }
      40% { 
        transform: translateX(-50%) translateY(30px) scale(1.3); 
        opacity: 1; 
      }
      60% { 
        transform: translateX(-50%) translateY(-20px) scale(0.95); 
      }
      100% { 
        transform: translateX(-50%) translateY(0) scale(1); 
      }
    }

    .notification-logo.animate {
      animation: notificationLogoEntrance 1.5s cubic-bezier(0.25, 0.8, 0.25, 1) forwards;
    }

    /* Mensagem da notifica√ß√£o - centralizada abaixo do logo */
    .notification-message {
      position: absolute;
      top: 55%; /* Abaixo do logo (que termina em 25% + altura) */
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(45deg, #28a745, #20c997);
      color: white;
      padding: 20px 30px;
      border-radius: 25px;
      box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.8);
      transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
      text-align: center;
      font-weight: 600;
      max-width: 80%;
      z-index: 102;
    }

    .notification-message.show {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }

    /* Efeitos especiais do canvas durante a notifica√ß√£o - aumentar intensidade */
    .notification-container.show ~ #spaceCanvas,
    .notification-container.show ~ .nebula,
    .notification-container.show ~ #spaceCanvas::before {
      animation-duration: 0.5s !important; /* Acelerar anima√ß√µes para mais dinamismo */
      opacity: 0.8 !important;
    }

    .notification-container.show ~ canvas {
      filter: brightness(1.2) contrast(1.1); /* Aumentar brilho e contraste dos efeitos */
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideIn {
      from { transform: translateY(-50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    @media (max-width: 768px) {
      .technicians-modal-content {
        width: 85%; /* Reduzido de 95% para 85% em mobile para menor largura */
        margin: 10% auto;
        padding: 20px;
      }

      .pix-buttons {
        gap: 8px;
        padding: 5px 0;
      }

      .pix-button {
        font-size: 1.3rem;
        padding: 12px 20px;
        min-width: 160px;
      }

      .pix-key-display {
        font-size: 0.9rem;
      }

      .notification-message {
        padding: 15px 20px;
        max-width: 90%;
        font-size: 0.9rem;
        top: 60%; /* Ajuste para mobile */
      }

      .notification-logo {
        top: 20%; /* Ajuste para mobile */
        width: 120px;
      }

      .notification-container.show ~ canvas {
        filter: brightness(1.3) contrast(1.2); /* Mais intenso em mobile */
      }
    }

    @keyframes entradaLogo {
      0% { transform: translateY(100vh) scale(0.7); opacity: 0; }
      40% { transform: translateY(30px) scale(1.3); opacity: 1; }
      60% { transform: translateY(-20px) scale(0.95); }
      100% { transform: translateY(0) scale(1); }
    }

    @keyframes textoAparece {
      0% { opacity: 0; transform: translateY(40px); filter: blur(8px); }
      50% { opacity: 0.8; transform: translateY(0); filter: blur(0); }
      100% { opacity: 1; transform: translateY(0); filter: blur(0); }
    }

    @keyframes zoomLogo {
      0% { transform: translateY(0) scale(1); filter: brightness(1.3); }
      100% { transform: translateY(-120vh) scale(0.25); filter: brightness(2.5) drop-shadow(0 0 70px rgba(255, 150, 50, 1)); }
    }

    @keyframes pulsoRastro {
      0% { opacity: 0.9; transform: scaleY(1) scaleX(1); }
      50% { opacity: 1; transform: scaleY(1.3) scaleX(0.8); }
      100% { opacity: 0.9; transform: scaleY(1) scaleX(1); }
    }

    @keyframes pulsoRastroCore {
      0% { opacity: 0.95; transform: scaleY(1); }
      50% { opacity: 1; transform: scaleY(1.25); }
      100% { opacity: 0.95; transform: scaleY(1); }
    }

    @keyframes cameraZoom {
      0% { transform: scale(1); }
      100% { transform: scale(2); }
    }

    @keyframes nebulaPulse {
      0% { opacity: 0.6; transform: scale(1) rotate(0deg); }
      25% { opacity: 0.7; transform: scale(1.02) rotate(1deg); }
      50% { opacity: 0.6; transform: scale(1) rotate(0deg); }
      75% { opacity: 0.65; transform: scale(1.01) rotate(-1deg); }
      100% { opacity: 0.6; transform: scale(1) rotate(0deg); }
    }

    @keyframes flareEffect {
      0% { opacity: 0.9; transform: scale(0.1) rotate(0deg); }
      50% { opacity: 0.5; transform: scale(1.2) rotate(180deg); }
      100% { opacity: 0; transform: scale(2) rotate(360deg); }
    }

    @keyframes flameFlicker {
      0%, 100% { transform: scale(1) rotate(-2deg); opacity: 0.8; }
      50% { transform: scale(1.2) rotate(2deg); opacity: 1; }
    }

    @keyframes powerUpPulse {
      0% { transform: scale(1); box-shadow: 0 0 10px rgba(0, 255, 255, 0.5); }
      50% { transform: scale(1.1); box-shadow: 0 0 20px rgba(0, 255, 255, 0.8); }
      100% { transform: scale(1); box-shadow: 0 0 10px rgba(0, 255, 255, 0.5); }
    }

    .powerup {
      position: absolute;
      border-radius: 50%;
      animation: powerUpPulse 2s ease-in-out infinite;
    }
  </style>
</head>
<body>
  <canvas id="spaceCanvas"></canvas>
  <div class="nebula"></div>
  <div class="hyperdrive" id="hyperdrive"></div>
  <div class="rastro" id="rastro"></div>
  <div class="rastro-core" id="rastroCore"></div>
  <div class="flare" id="flare"></div>
  <img id="logo" src="logo.png" alt="IndaiaFibra Logo" onclick="startGame()">
  <p id="text1">Avalie nosso servi√ßo</p>
  <p id="text2">Obrigado!</p>
  <div class="button-container">
        <button id="evaluateButton" onclick="triggerExitSequence()">Avaliar Agora</button>
    <button id="tipButton" onclick="openTechniciansModal()">Caixa de natalüéÖüèΩ</button>

  </div>
  <div class="overlay" id="overlay"></div>
  <div id="gameOverOverlay">
    <h2>Game Over!</h2>
    <p>PONTUA√á√ÉO: <span class="score">0</span></p>
    <ul id="top5"></ul>
    <div id="nameInput"></div>
    <button onclick="restartGame()">Jogar Novamente</button>
    <button onclick="exitGame()">Sair do Jogo</button>
    <button onclick="triggerExitSequence()">Avaliar Servi√ßo</button>
  </div>

  <!-- Modal para T√©cnicos (agora com scroll horizontal de bot√µes e revela√ß√£o da chave ao clicar) -->
  <div id="techniciansModal" class="technicians-modal">
    <div class="technicians-modal-content">
      <span class="close" onclick="closeTechniciansModal()">&times;</span>
      <h2>Envie uma gorjeta ao t√©cnico</h2>
      <p>Deslize para o lado e selecione o t√©cnico para revelar sua chave PIX e copi√°-la automaticamente!</p>
      <div class="pix-buttons" id="pixButtons">
        <!-- Bot√µes gerados dinamicamente no JS -->
      </div>
      <div class="selected-key" id="selectedKey">
        <div class="pix-key-display" id="revealedKey"></div>
        <p class="gratitude-message">Fa√ßa a transfer√™ncia de qualquer valor como gesto de gratid√£o!</p>
      </div>
    </div>
  </div>

  <!-- Container da Notifica√ß√£o com Logo Voando e Fundo Borrado -->
  <div id="notificationContainer" class="notification-container">
    <div class="notification-backdrop" id="notificationBackdrop"></div>
    <img id="notificationLogo" class="notification-logo" src="logo.png" alt="Logo IndaiaFibra">
    <div id="notificationMessage" class="notification-message">
      Muito obrigado por confiar no meu trabalho! <br><small>Chave PIX do <span id="copiedTech"></span> foi copiada!</small>
    </div>
  </div>

  <!-- Sons de fundo e efeitos -->
  <audio id="ambientSound" src="ambient.mp3" loop volume="0.3"></audio>
  <audio id="shootSound" src="shoot.mp3" preload="auto"></audio>
  <audio id="explosionSound" src="explosion.mp3" preload="auto"></audio>
  <audio id="powerupSound" src="powerup.mp3" preload="auto"></audio>
  <audio id="shieldSound" src="shield.mp3" preload="auto"></audio>
  <audio id="hitSound" src="hit.mp3" preload="auto"></audio>
  <audio id="thrustSound" src="thrust.mp3" loop preload="auto"></audio>

  <script>
    const canvas = document.getElementById('spaceCanvas');
    const ctx = canvas.getContext('2d');
    const logo = document.getElementById('logo');
    const rastro = document.getElementById('rastro');
    const rastroCore = document.getElementById('rastroCore');
    const flare = document.getElementById('flare');
    const overlay = document.getElementById('overlay');
    const gameOverOverlay = document.getElementById('gameOverOverlay');
    const buttonContainer = document.querySelector('.button-container');
    const techniciansModal = document.getElementById('techniciansModal');
    const notificationContainer = document.getElementById('notificationContainer');
    const notificationBackdrop = document.getElementById('notificationBackdrop');
    const notificationLogo = document.getElementById('notificationLogo');
    const notificationMessage = document.getElementById('notificationMessage');
    const copiedTech = document.getElementById('copiedTech');
    const pixButtons = document.getElementById('pixButtons');
    const selectedKey = document.getElementById('selectedKey');
    const revealedKey = document.getElementById('revealedKey');
    const pageStartTime = Date.now();
    let rafIdStars, rafIdParticles, rafIdGame;
    let hyperdriveActive = false;
    let gameActive = false;
    let lastTime = 0;
    const shipImg = new Image();
    shipImg.src = 'logo.png';
    let shipX, shipY, shipWidth = 120, shipHeight = 120;
    let score = 0;
    let lives = 5;
    let gameStartTime;
    let keys = {};
    let asteroids = [];
    let powerups = [];
    let bullets = [];
    let thrustParticles = [];
    let explosionParticles = [];
    let asteroidFlames = [];
    let powerUpLevel = 0;
    let baseSpeed = 4;
    let currentSpeed = baseSpeed;
    let shieldActive = false;
    let shieldCount = 0;
    let shieldEndTime = 0;
    let speedBoostEndTime = 0;
    let touchActive = false;
    let doubleClickTimer = 0;
    let difficultyLevel = 0;
    let asteroidSpawnRate = 0.03;
    let maxAsteroidSpeed = 6;
    let lastDifficultyIncrease = 0;
    let isThrusting = false;
    let wasMoving = false;

    const API_URL = 'https://68f458d8b16eb6f46834542c.mockapi.io/Rexord/Pomtos';

    // Dados dos t√©cnicos (chaves PIX hardcoded)
    const technicians = [
      { name: 'Guilherme', key: '39892797850', emoji: 'üë∑üèΩ‚Äç‚ôÇÔ∏è' },
      { name: 'S√©rgio', key: '19992681056', emoji: 'üë∑üèΩ‚Äç‚ôÇÔ∏è' },
      { name: 'Andr√©', key: '28087258843', emoji: 'üë∑üèΩ‚Äç‚ôÇÔ∏è' },
      { name: 'Washington', key: 'PIX-CHAVE-WASHINGTON', emoji: 'üë∑üèΩ‚Äç‚ôÇÔ∏è' },
      { name: 'Robson', key: 'PIX-CHAVE-ROBSON', emoji: 'üë∑üèΩ‚Äç‚ôÇÔ∏è' },
      { name: 'Elvis', key: 'PIX-CHAVE-ELVIS', emoji: 'üë∑üèΩ‚Äç‚ôÇÔ∏è' },
      { name: 'Janderson', key: 'PIX-CHAVE-JANDERSON', emoji: 'üë∑üèΩ‚Äç‚ôÇÔ∏è' }
    ];

    // Sons
    const ambientSound = document.getElementById('ambientSound');
    const shootSound = document.getElementById('shootSound');
    const explosionSound = document.getElementById('explosionSound');
    const powerupSound = document.getElementById('powerupSound');
    const shieldSound = document.getElementById('shieldSound');
    const hitSound = document.getElementById('hitSound');
    const thrustSound = document.getElementById('thrustSound');

    // Fun√ß√£o para tocar som
    function playSound(sound) {
      sound.currentTime = 0;
      sound.volume = 0.5; // Volume padr√£o para efeitos
      sound.play().catch(e => console.log('Erro ao tocar som:', e));
    }

    // Modal functions
    function openTechniciansModal() {
      techniciansModal.style.display = 'block';
      document.body.style.overflow = 'hidden';
      generatePixButtons();
    }

    function closeTechniciansModal() {
      techniciansModal.style.display = 'none';
      document.body.style.overflow = 'auto';
      selectedKey.classList.remove('show');
      revealedKey.textContent = '';
      // Resetar bot√µes selecionados
      document.querySelectorAll('.pix-button').forEach(btn => btn.classList.remove('selected'));
    }

    // Gerar bot√µes horizontais dinamicamente
    function generatePixButtons() {
      pixButtons.innerHTML = '';
      technicians.forEach(tech => {
        const button = document.createElement('button');
        button.className = 'pix-button';
        button.innerHTML = `${tech.emoji} ${tech.name}`;
        button.dataset.techName = tech.name;
        button.dataset.pixKey = tech.key;
        button.onclick = () => selectTechnician(tech.name, tech.key);
        pixButtons.appendChild(button);
      });
    }

    // Selecionar t√©cnico: revelar chave, copiar e notificar
    async function selectTechnician(techName, pixKey) {
      // Revelar chave
      revealedKey.textContent = pixKey;
      selectedKey.classList.add('show');

      // Copiar para clipboard
      try {
        await copyToClipboard(pixKey);
        showNotification(techName);
      } catch (err) {
        console.error('Erro ao copiar:', err);
        alert('Erro ao copiar a chave PIX. Tente novamente.');
      }

      // Destacar bot√£o selecionado
      document.querySelectorAll('.pix-button').forEach(btn => btn.classList.remove('selected'));
      event.target.classList.add('selected');

      // Scroll suave para o bot√£o se necess√°rio
      event.target.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
    }

    // Fun√ß√£o para mostrar notifica√ß√£o com logo voando e fundo borrado
    function showNotification(techName) {
      copiedTech.textContent = techName;
      
      // Mostrar container
      notificationContainer.classList.add('show');
      
      // Iniciar anima√ß√£o do logo voando
      notificationLogo.style.opacity = '1';
      notificationLogo.classList.add('animate');

      // Ap√≥s logo chegar (1.5s), mostrar fundo borrado e mensagem
      setTimeout(() => {
        notificationBackdrop.classList.add('show');
        notificationMessage.classList.add('show');
      }, 1500);

      // Manter mensagem por 4 segundos
      setTimeout(() => {
        // Fade out da mensagem e fundo
        notificationMessage.classList.remove('show');
        notificationBackdrop.classList.remove('show');
        
        // Ap√≥s fade out (0.5s), esconder logo e container
        setTimeout(() => {
          notificationLogo.classList.remove('animate');
          notificationLogo.style.opacity = '0';
          notificationContainer.classList.remove('show');
        }, 500);
      }, 1500 + 4000); // 1.5s logo + 4s mensagem
    }

    // Fun√ß√£o para copiar para clipboard
    async function copyToClipboard(text) {
      try {
        await navigator.clipboard.writeText(text);
      } catch (err) {
        // Fallback
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
      }
    }

    // Fechar modal ao clicar fora
    window.onclick = function(event) {
      if (event.target === techniciansModal) {
        closeTechniciansModal();
      }
    }

    // Cores para o rastro baseadas no powerUpLevel
    const trailColors = {
      0: { fire: 'hsl(20, 100%, 50%)', smoke: 'hsl(20, 20%, 50%)' }, // Laranja para default, fuma√ßa marrom
      1: { fire: 'hsl(200, 100%, 50%)', smoke: 'hsl(200, 50%, 60%)' },
      2: { fire: 'hsl(60, 100%, 50%)', smoke: 'hsl(60, 50%, 70%)' },
      3: { fire: 'hsl(340, 100%, 50%)', smoke: 'hsl(340, 50%, 60%)' }
    };

    // Fun√ß√£o para vibra√ß√£o em dispositivos m√≥veis
    function vibrate(duration = 100) {
      if ('vibrate' in navigator && window.matchMedia('(pointer: coarse)').matches) {
        navigator.vibrate(duration);
      }
    }

    async function fetchScores() {
      try {
        const res = await fetch(API_URL);
        if (!res.ok) return [];
        return await res.json();
      } catch (e) {
        console.error('Erro ao buscar scores:', e);
        return [];
      }
    }

    async function saveScore(name, score) {
      try {
        await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, score })
        });
      } catch (e) {
        console.error('Erro ao salvar score:', e);
        alert('Erro ao salvar score. Tente novamente.');
      }
    }

    async function fetchTop5(currentScore, showInput = true) {
      const scores = await fetchScores();
      const top = scores.sort((a, b) => b.score - a.score).slice(0, 5);
      const topList = document.getElementById('top5');
      topList.innerHTML = top.length ? top.map((s, i) => `<li>${i + 1}. ${s.name}: ${s.score}</li>`).join('') : '<li>Nenhum recorde ainda</li>';

      const fifthScore = top[4]?.score || 0;
      if (showInput && (currentScore > fifthScore || top.length < 5)) {
        let inputDiv = document.getElementById('nameInput');
        if (!inputDiv.children.length) {
          inputDiv.innerHTML = `
            <p style="font-size: 1.2rem; margin: 0;">Novo recorde! Insira seu nome:</p>
            <input type="text" id="nameField" placeholder="Seu nome" maxlength="15">
            <button onclick="saveNewScore(${currentScore})">Salvar Score</button>
          `;
        }
        inputDiv.style.display = 'block';
      } else {
        document.getElementById('nameInput').style.display = 'none';
      }

      // Anima√ß√£o legal para o Ranking TOP 5
      setTimeout(() => {
        topList.classList.add('animate-ranking');
      }, 100);
    }

    function saveNewScore(currentScore) {
      const name = document.getElementById('nameField').value.trim();
      if (!name) {
        alert('Nome √© obrigat√≥rio!');
        return;
      }
      saveScore(name, currentScore).then(() => {
        const inputDiv = document.getElementById('nameInput');

        // Criar mensagem de sucesso
        const successMsg = document.createElement('p');
        successMsg.className = 'success-message';
        successMsg.innerHTML = '‚úÖ Score salvo com sucesso!';
        successMsg.style.opacity = '0';
        successMsg.style.transform = 'scale(0.8)';

        // Adicionar √† div e mostrar
        inputDiv.innerHTML = ''; // Limpa o input anterior
        inputDiv.appendChild(successMsg);
        inputDiv.style.display = 'block';

        // Anima√ß√£o de entrada
        setTimeout(() => {
          successMsg.classList.add('show');
        }, 10);

        // Anima√ß√£o de sa√≠da ap√≥s 1.5s
        setTimeout(() => {
          successMsg.style.opacity = '0';
          successMsg.style.transform = 'scale(1.1)';
          setTimeout(() => {
            inputDiv.removeChild(successMsg);
            inputDiv.innerHTML = '';
            inputDiv.style.display = 'none';
            fetchTop5(currentScore, false);
          }, 500);
        }, 1500);
      });
    }

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    const stars = Array.from({ length: 500 }, () => ({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      size: Math.random() * 2 + 0.3,
      speed: Math.random() * 1 + 0.2,
      brightness: Math.random() * 0.5 + 0.5,
      layer: Math.random() < 0.4 ? 'distant' : Math.random() < 0.6 ? 'mid' : 'near',
      isHyper: false
    }));

    function drawStars() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let s of stars) {
        ctx.fillStyle = s.layer === 'distant' ? '#888' : s.layer === 'mid' ? '#bbb' : '#fff';
        ctx.globalAlpha = s.brightness;
        if (hyperdriveActive && s.isHyper) {
          ctx.beginPath();
          ctx.moveTo(s.x, s.y);
          ctx.lineTo(s.x, s.y + s.size * 20);
          ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
          ctx.lineWidth = s.size * 2;
          ctx.lineCap = 'round';
          ctx.stroke();
          s.y += s.speed * 15;
        } else {
          ctx.beginPath();
          ctx.arc(s.x, s.y, s.layer === 'distant' ? s.size * 0.5 : s.layer === 'mid' ? s.size * 0.8 : s.size, 0, Math.PI * 2);
          ctx.fill();
          s.y += s.layer === 'distant' ? s.speed * 0.5 : s.layer === 'mid' ? s.speed * 0.8 : s.speed;
        }
        if (s.y > canvas.height) s.y = 0;
      }
      ctx.globalAlpha = 1;
      rafIdStars = requestAnimationFrame(drawStars);
    }

    const particles = [];
    function createParticle(x, y, isSmoke = false, customColor = null) {
      const color = customColor || (isSmoke ? `hsl(0, 0%, ${Math.random() * 20 + 50}%)` : `hsl(${Math.random() * 40 + 20}, 100%, ${Math.random() * 30 + 50}%)`);
      particles.push({
        x: x + (Math.random() * 50 - 25),
        y: y,
        alpha: 1,
        size: isSmoke ? Math.random() * 20 + 10 : Math.random() * 6 + 3,
        vx: isSmoke ? Math.random() * 2 - 1 : Math.random() * 4 - 2,
        vy: isSmoke ? Math.random() * 2 + 1 : Math.random() * 8 + 4,
        color: color,
        decay: isSmoke ? Math.random() * 0.01 + 0.005 : Math.random() * 0.03 + 0.02,
        rotation: Math.random() * Math.PI * 2,
        isSmoke
      });
    }

    function updateParticles() {
      const rect = logo.getBoundingClientRect();
      for (let i = 0; i < 3; i++) createParticle(rect.left + rect.width / 2, rect.bottom - 5);
      for (let i = 0; i < 2; i++) createParticle(rect.left + rect.width / 2, rect.bottom - 5, true);

      for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.alpha -= p.decay;
        p.size *= p.isSmoke ? 0.98 : 0.95;
        p.vy += 0.1;
        p.rotation += p.isSmoke ? 0.05 : 0.1;
        if (p.alpha <= 0 || p.size <= 0.1 || p.y > canvas.height) particles.splice(i, 1);
      }

      particles.forEach(p => {
        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rotation);
        ctx.fillStyle = p.color;
        ctx.globalAlpha = p.alpha;
        ctx.shadowColor = p.color;
        ctx.shadowBlur = 5;
        ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);
        if (!p.isSmoke && Math.random() < 0.2) {
          ctx.fillStyle = 'white';
          ctx.globalAlpha = p.alpha * 0.7;
          ctx.fillRect(-p.size / 4, -p.size / 4, p.size / 2, p.size / 2);
        }
        ctx.restore();
      });
      ctx.globalAlpha = 1;
      ctx.shadowBlur = 0;

      rastro.style.left = `${rect.left + rect.width / 2 - 50}px`;
      rastro.style.top = `${rect.bottom}px`;
      rastroCore.style.left = `${rect.left + rect.width / 2 - 10}px`;
      rastroCore.style.top = `${rect.bottom}px`;

      rafIdParticles = requestAnimationFrame(updateParticles);
    }

    // Fun√ß√£o para criar part√≠culas de thrust com cor baseada no powerUpLevel e fuma√ßa marrom
    function createThrustParticle(x, y) {
      const colors = trailColors[powerUpLevel] || trailColors[0];
      // Fogo
      for (let i = 0; i < 3; i++) {
        thrustParticles.push({
          x: x + Math.random() * 20 - 10,
          y: y + shipHeight,
          vx: (Math.random() - 0.5) * 5,
          vy: Math.random() * 4 + 3,
          size: Math.random() * 10 + 4,
          alpha: 1,
          color: colors.fire,
          decay: 0.04,
          life: 35,
          glow: true
        });
      }
      // Poeira/fuma√ßa marrom
      for (let i = 0; i < 4; i++) {
        thrustParticles.push({
          x: x + Math.random() * 20 - 10,
          y: y + shipHeight,
          vx: (Math.random() - 0.5) * 3,
          vy: Math.random() * 3 + 1.5,
          size: Math.random() * 8 + 3,
          alpha: 0.8,
          color: colors.smoke, // Marrom
          decay: 0.025,
          life: 45,
          trail: true
        });
      }
    }

    // Update thrust particles
    function updateThrustParticles() {
      for (let i = thrustParticles.length - 1; i >= 0; i--) {
        const p = thrustParticles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.15;
        p.alpha -= p.decay;
        p.size *= 0.97;
        p.life--;
        if (p.alpha <= 0 || p.life <= 0 || p.y > canvas.height) {
          thrustParticles.splice(i, 1);
        }
      }
    }

    // Draw thrust particles
    function drawThrustParticles() {
      thrustParticles.forEach(p => {
        ctx.save();
        if (p.glow) {
          ctx.shadowColor = p.color;
          ctx.shadowBlur = 10;
        }
        ctx.globalAlpha = p.alpha;
        ctx.fillStyle = p.color;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fill();
        if (p.trail && Math.random() < 0.3) {
          ctx.globalAlpha = p.alpha * 0.5;
          ctx.fillStyle = 'rgba(139, 69, 19, 0.3)'; // Marrom claro para trail
          ctx.beginPath();
          ctx.arc(p.x - p.vx * 2, p.y - p.vy * 2, p.size * 0.5, 0, Math.PI * 2);
          ctx.fill();
        }
        ctx.restore();
      });
      ctx.shadowBlur = 0;
    }

    // Part√≠culas de explos√£o marrom
    function createExplosion(x, y, count = 8) {
      for (let i = 0; i < count; i++) {
        explosionParticles.push({
          x: x,
          y: y,
          vx: (Math.random() - 0.5) * 10,
          vy: (Math.random() - 0.5) * 10,
          size: Math.random() * 6 + 3,
          alpha: 1,
          color: `hsl(20, 30%, ${Math.random() * 20 + 30}%)`, // Tons de marrom
          decay: 0.05,
          life: 30,
          glow: true
        });
      }
    }

    function updateExplosionParticles() {
      for (let i = explosionParticles.length - 1; i >= 0; i--) {
        const p = explosionParticles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.vx *= 0.98;
        p.vy *= 0.98;
        p.alpha -= p.decay;
        p.size *= 0.95;
        p.life--;
        if (p.alpha <= 0 || p.life <= 0) {
          explosionParticles.splice(i, 1);
        }
      }
    }

    function drawExplosionParticles() {
      explosionParticles.forEach(p => {
        ctx.save();
        ctx.shadowColor = p.color;
        ctx.shadowBlur = 8;
        ctx.globalAlpha = p.alpha;
        ctx.fillStyle = p.color;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
      });
      ctx.shadowBlur = 0;
    }

    // Chamas para asteroides
    function createAsteroidFlame(a) {
      if (!a.flames) a.flames = [];
      for (let i = 0; i < 3; i++) {
        a.flames.push({
          x: a.x + (Math.random() - 0.5) * a.size,
          y: a.y + a.size / 2,
          vx: (Math.random() - 0.5) * 2,
          vy: Math.random() * -2 - 1,
          size: Math.random() * 4 + 2,
          alpha: Math.random() * 0.5 + 0.5,
          color: `hsl(${20 + Math.random() * 40}, 100%, ${50 + Math.random() * 30}%)`,
          life: 20 + Math.random() * 10
        });
      }
    }

    function updateAsteroidFlames() {
      asteroids.forEach(a => {
        if (a.flames) {
          for (let i = a.flames.length - 1; i >= 0; i--) {
            const f = a.flames[i];
            f.x += f.vx;
            f.y += f.vy;
            f.vy += 0.1;
            f.alpha -= 0.05;
            f.life--;
            if (f.alpha <= 0 || f.life <= 0) {
              a.flames.splice(i, 1);
            }
          }
          if (Math.random() < 0.3) createAsteroidFlame(a); // Manter chamas vivas
        } else {
          createAsteroidFlame(a);
        }
      });
    }

    function drawAsteroidFlames() {
      asteroids.forEach(a => {
        if (a.flames) {
          a.flames.forEach(f => {
            ctx.save();
            ctx.globalAlpha = f.alpha;
            ctx.fillStyle = f.color;
            ctx.shadowColor = f.color;
            ctx.shadowBlur = 6;
            ctx.beginPath();
            ctx.ellipse(f.x, f.y, f.size, f.size * 1.5, 0, 0, Math.PI * 2); // Elipse para chama
            ctx.fill();
            ctx.restore();
          });
        }
      });
      ctx.shadowBlur = 0;
    }

    // Fun√ß√£o para atirar baseada no n√≠vel de power-up
    function shoot() {
      if (powerUpLevel === 0) return;

      const shipCenterX = shipX + shipWidth / 2;
      const shipCenterY = shipY;
      const baseSpeed = 10 + powerUpLevel * 5; // Velocidade base aumenta com n√≠vel
      const baseSize = 2 + powerUpLevel * 2; // Calibre (tamanho) aumenta
      const color = powerUpLevel === 1 ? '#00ffff' : powerUpLevel === 2 ? '#ffff00' : '#ff0000';

      if (powerUpLevel === 1) {
        // Tiro √∫nico reto
        bullets.push({
          x: shipCenterX,
          y: shipCenterY,
          vx: 0,
          vy: -baseSpeed,
          size: baseSize,
          color: color
        });
      } else if (powerUpLevel === 2) {
        // Dois tiros paralelos
        const offset = 15;
        bullets.push({
          x: shipCenterX - offset,
          y: shipCenterY,
          vx: 0,
          vy: -baseSpeed,
          size: baseSize,
          color: color
        });
        bullets.push({
          x: shipCenterX + offset,
          y: shipCenterY,
          vx: 0,
          vy: -baseSpeed,
          size: baseSize,
          color: color
        });
      } else if (powerUpLevel === 3) {
        // Tr√™s tiros em spread (leque)
        const angleSpread = Math.PI / 6; // 30 graus de spread total
        for (let i = -1; i <= 1; i++) {
          const angle = i * (angleSpread / 2);
          bullets.push({
            x: shipCenterX,
            y: shipCenterY,
            vx: Math.sin(angle) * baseSpeed * 0.3, // Lateral pequeno
            vy: -Math.cos(angle) * baseSpeed,
            size: baseSize,
            color: color
          });
        }
      }

      playSound(shootSound);
      vibrate(30 + powerUpLevel * 10); // Vibra√ß√£o maior com n√≠vel mais alto
    }

    // Game functions
    function startGame() {
      if (gameActive) return;
      gameActive = true;
      // Remover completamente os bot√µes principais
      buttonContainer.style.display = 'none';
      logo.style.opacity = '0';
      document.querySelector('#text1').style.display = 'none';
      document.querySelector('#text2').style.display = 'none';
      flare.style.opacity = '0';
      cancelAnimationFrame(rafIdStars);
      cancelAnimationFrame(rafIdParticles);
      particles.length = 0;
      thrustParticles.length = 0;
      explosionParticles.length = 0;
      asteroidFlames = [];
      shipX = (canvas.width - shipWidth) / 2;
      shipY = canvas.height - shipHeight - 50;
      score = 0;
      lives = 5;
      shieldCount = 0;
      asteroids = [];
      powerups = [];
      bullets = [];
      powerUpLevel = 0;
      gameStartTime = Date.now();
      lastDifficultyIncrease = gameStartTime;
      difficultyLevel = 0;
      asteroidSpawnRate = 0.01;
      maxAsteroidSpeed = 2;
      keys = {};
      currentSpeed = baseSpeed;
      shieldActive = false;
      speedBoostEndTime = 0;
      isThrusting = false;
      wasMoving = false;
      lastTime = performance.now();
      // Iniciar som ambiente
      ambientSound.play().catch(e => console.log('Erro ao tocar som ambiente:', e));
      gameLoop(lastTime);
    }

    function gameLoop(currentTime) {
      if (!gameActive) {
        rafIdGame = requestAnimationFrame(gameLoop);
        return;
      }
      const deltaTime = (currentTime - lastTime) / 16.67;
      lastTime = currentTime;

      const gameTime = Date.now() - gameStartTime;
      const newLevel = Math.floor(gameTime / 10000);
      if (newLevel > difficultyLevel) {
        difficultyLevel = newLevel;
        asteroidSpawnRate += 0.005;
        maxAsteroidSpeed += 1;
      }

      if (Date.now() > speedBoostEndTime) currentSpeed = baseSpeed;
      else currentSpeed = baseSpeed * 1.5;
      if (Date.now() > shieldEndTime) {
        shieldCount = 0;
        shieldActive = false;
      } else {
        shieldActive = shieldCount > 0;
      }

      let moving = false;
      const speed = currentSpeed * deltaTime * (window.innerWidth > 768 ? 1 : 0.8);
      if (keys['ArrowLeft'] || keys['a'] || keys['A']) {
        shipX = Math.max(0, shipX - speed);
        moving = true;
      }
      if (keys['ArrowRight'] || keys['d'] || keys['D']) {
        shipX = Math.min(canvas.width - shipWidth, shipX + speed);
        moving = true;
      }
      if (keys['ArrowUp'] || keys['w'] || keys['W']) {
        shipY = Math.max(0, shipY - speed);
        moving = true;
      }
      if (keys['ArrowDown'] || keys['s'] || keys['S']) {
        shipY = Math.min(canvas.height - shipHeight, shipY + speed);
        moving = true;
      }

      // Gerenciar som de thrust
      if (moving) {
        if (!isThrusting) {
          thrustSound.volume = 0.3;
          thrustSound.play().catch(e => console.log('Erro ao tocar thrust:', e));
          isThrusting = true;
        }
        if (!wasMoving && Math.random() < 0.6) {
          createThrustParticle(shipX + shipWidth / 2, shipY);
        }
      } else {
        if (isThrusting) {
          thrustSound.pause();
          thrustSound.currentTime = 0;
          isThrusting = false;
        }
      }
      wasMoving = moving;

      // Atirar baseado no powerUpLevel
      if (keys[' '] && powerUpLevel > 0) {
        shoot();
        keys[' '] = false;
      }

      for (let s of stars) {
        const layerSpeed = (s.layer === 'distant' ? s.speed * 0.5 : s.layer === 'mid' ? s.speed * 0.8 : s.speed) * 1.2 * deltaTime;
        s.y += layerSpeed;
        if (s.y > canvas.height) s.y = 0;
        const dx = s.x - (shipX + shipWidth / 2);
        const dy = s.y - (shipY + shipHeight / 2);
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < s.size + shipWidth / 4) {
          score += 10;
          s.x = Math.random() * canvas.width;
          s.y = -10;
        }
      }

      for (let i = bullets.length - 1; i >= 0; i--) {
        let b = bullets[i];
        b.x += b.vx * deltaTime;
        b.y += b.vy * deltaTime;
        if (b.y < 0) {
          bullets.splice(i, 1);
          continue;
        }
        for (let j = asteroids.length - 1; j >= 0; j--) {
          let a = asteroids[j];
          const bdx = b.x - a.x;
          const bdy = b.y - a.y;
          const bdist = Math.sqrt(bdx * bdx + bdy * bdy);
          if (bdist < b.size + a.size) {
            score += 20 * powerUpLevel; // Pontos extras baseado no n√≠vel
            bullets.splice(i, 1);
            createExplosion(a.x, a.y, 12); // Explos√£o marrom
            playSound(explosionSound);
            vibrate(50); // Vibra√ß√£o no acerto
            asteroids.splice(j, 1);
            break;
          }
        }
      }

      for (let i = asteroids.length - 1; i >= 0; i--) {
        let a = asteroids[i];
        a.y += a.speed * deltaTime;
        if (a.y > canvas.height) {
          asteroids.splice(i, 1);
          continue;
        }
        const dx = a.x - (shipX + shipWidth / 2);
        const dy = a.y - (shipY + shipHeight / 2);
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < a.size + shipWidth / 4) {
          if (shieldCount > 0) {
            shieldCount--;
            createParticle(a.x, a.y, true, 'rgba(0,255,0,0.5)');
            playSound(shieldSound);
            vibrate(100); // Vibra√ß√£o no bloqueio de escudo
            asteroids.splice(i, 1);
          } else {
            lives--;
            createExplosion(shipX + shipWidth / 2, shipY + shipHeight / 2, 15); // Explos√£o no impacto
            playSound(hitSound);
            vibrate(200); // Vibra√ß√£o forte no impacto
            asteroids.splice(i, 1);
            if (lives <= 0) {
              endGame();
              return;
            }
          }
        }
      }

      for (let i = powerups.length - 1; i >= 0; i--) {
        let p = powerups[i];
        p.y += p.speed * deltaTime;
        if (p.y > canvas.height) {
          powerups.splice(i, 1);
          continue;
        }
        const dx = p.x - (shipX + shipWidth / 2);
        const dy = p.y - (shipY + shipHeight / 2);
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < p.size + shipWidth / 4) {
          powerUpLevel = Math.min(3, powerUpLevel + 1);
          applyPowerUp(p.type);
          powerups.splice(i, 1);
          playSound(powerupSound);
          vibrate(150); // Vibra√ß√£o no power-up
          for (let k = 0; k < 6; k++) {
            createParticle(p.x, p.y, false);
          }
        }
      }

      if (Math.random() < asteroidSpawnRate * deltaTime) {
        asteroids.push({
          x: Math.random() * canvas.width,
          y: 0,
          size: Math.random() * 20 + 15,
          speed: Math.random() * maxAsteroidSpeed + 3,
          flames: []
        });
      }

      if (Math.random() < 0.002 * deltaTime) {
        const types = ['speed', 'shield', 'life'];
        const type = types[Math.floor(Math.random() * types.length)];
        powerups.push({
          x: Math.random() * canvas.width,
          y: 0,
          size: 12,
          speed: Math.random() * 2 + 1,
          type: type
        });
      }

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      for (let s of stars) {
        ctx.fillStyle = s.layer === 'distant' ? '#888' : s.layer === 'mid' ? '#bbb' : '#fff';
        ctx.globalAlpha = s.brightness;
        const r = s.layer === 'distant' ? s.size * 0.5 : s.layer === 'mid' ? s.size * 0.8 : s.size;
        ctx.beginPath();
        ctx.arc(s.x, s.y, r, 0, Math.PI * 2);
        ctx.fill();
      }
      ctx.globalAlpha = 1;

      // Draw asteroid flames
      updateAsteroidFlames();
      drawAsteroidFlames();

      // Draw asteroids com emoji ü™® e chamas
      ctx.shadowColor = 'rgba(139, 69, 19, 0.8)';
      ctx.shadowBlur = 10;
      ctx.font = 'bold 20px Arial, sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      for (let a of asteroids) {
        ctx.font = `bold ${a.size * 1.2}px Arial, sans-serif`;
        ctx.fillStyle = '#8B4513';
        ctx.fillText('ü™®', a.x, a.y);
      }
      ctx.shadowBlur = 0;
      ctx.textAlign = 'left';
      ctx.textBaseline = 'alphabetic';

      bullets.forEach(b => {
        ctx.shadowColor = b.color;
        ctx.shadowBlur = 10;
        ctx.fillStyle = b.color;
        ctx.beginPath();
        ctx.rect(b.x - b.size / 2, b.y - b.size * 2, b.size, b.size * 4);
        ctx.fill();
        ctx.beginPath();
        ctx.arc(b.x, b.y, b.size, 0, Math.PI * 2);
        ctx.fill();
        ctx.shadowBlur = 0;
      });

      // Draw powerups com √≠cones bonitos (emojis) e anima√ß√£o radial
      for (let p of powerups) {
        const pulseSize = p.size + Math.sin(Date.now() / 200) * 2;
        ctx.shadowColor = p.type === 'speed' ? '#00ffff' : p.type === 'shield' ? '#00ff00' : '#8000ff';
        ctx.shadowBlur = 12;
        ctx.fillStyle = p.type === 'speed' ? 'rgba(0, 255, 255, 0.9)' : p.type === 'shield' ? 'rgba(0, 255, 0, 0.9)' : 'rgba(128, 0, 255, 0.9)';
        ctx.beginPath();
        ctx.arc(p.x, p.y, pulseSize, 0, Math.PI * 2);
        ctx.fill();
        ctx.shadowBlur = 0;
        ctx.font = `${Math.min(16, canvas.width / 60)}px Arial, sans-serif`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        const icon = p.type === 'speed' ? 'üöÄ' : p.type === 'shield' ? 'üõ°Ô∏è' : '‚ù§Ô∏è';
        ctx.fillText(icon, p.x, p.y);
      }
      ctx.textAlign = 'left';
      ctx.textBaseline = 'alphabetic';

      drawThrustParticles();
      updateThrustParticles();

      updateExplosionParticles();
      drawExplosionParticles();

      // Part√≠culas de exaust√£o como na intro (sempre ativas durante o jogo, igual √† anima√ß√£o inicial)
      const exhaustX = shipX + shipWidth / 2;
      const exhaustY = shipY + shipHeight;
      // Sempre criar part√≠culas para simular thrust constante, mais vis√≠vel
      for (let i = 0; i < 5; i++) { // Aumentado para 5 para mais visibilidade
        createParticle(exhaustX, exhaustY - 5);
      }
      for (let i = 0; i < 1; i++) { // Diminu√≠do para 1 para menos fuma√ßa
        createParticle(exhaustX, exhaustY - 5, true);
      }

      // Atualizar part√≠culas
      for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.alpha -= p.decay * 0.8; // Reduzido decay para trails mais longos e vis√≠veis
        p.size *= p.isSmoke ? 0.99 : 0.96; // Ajustado para part√≠culas maiores por mais tempo
        p.vy += 0.1;
        p.rotation += p.isSmoke ? 0.05 : 0.1;
        if (p.alpha <= 0 || p.size <= 0.1 || p.y > canvas.height) particles.splice(i, 1);
      }

      // Desenhar part√≠culas
      particles.forEach(p => {
        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rotation);
        ctx.fillStyle = p.color;
        ctx.globalAlpha = p.alpha;
        ctx.shadowColor = p.color;
        ctx.shadowBlur = 8; // Aumentado blur para mais glow
        ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);
        if (!p.isSmoke && Math.random() < 0.3) { // Aumentada chance de brilho
          ctx.fillStyle = 'white';
          ctx.globalAlpha = p.alpha * 0.8;
          ctx.fillRect(-p.size / 4, -p.size / 4, p.size / 2, p.size / 2);
        }
        ctx.restore();
      });
      ctx.globalAlpha = 1;
      ctx.shadowBlur = 0;

      // Posicionar rastro abaixo da nave
      rastro.style.left = `${exhaustX - 50}px`;
      rastro.style.top = `${exhaustY}px`;
      rastroCore.style.left = `${exhaustX - 10}px`;
      rastroCore.style.top = `${exhaustY}px`;

      // Cores do escudo baseadas na quantidade
      let shieldColor = 'rgba(21, 94, 183, 1)';
      if (shieldCount === 1) {
        shieldColor = 'rgba(0, 255, 0, 1)'; // Verde
      } else if (shieldCount === 2) {
        shieldColor = 'rgba(128, 0, 128, 1)'; // Roxo
      } else if (shieldCount === 3) {
        shieldColor = 'rgba(0, 0, 255, 1)'; // Azul
      }
      ctx.shadowColor = shieldActive ? shieldColor : 'rgba(21, 94, 183, 1)';
      ctx.shadowBlur = shieldActive ? 30 : 20;
      if (shipImg.complete) {
        ctx.drawImage(shipImg, shipX, shipY, shipWidth, shipHeight);
      }
      ctx.shadowBlur = 0;

      const uiScale = window.innerWidth > 768 ? 1 : 0.8;
      ctx.shadowColor = 'rgba(255, 255, 255, 0.5)';
      ctx.shadowBlur = 5;
      ctx.fillStyle = 'white';
      ctx.font = `bold ${Math.min(24, canvas.width / 30) * uiScale}px 'Poppins', sans-serif`;
      ctx.textAlign = 'left';
      ctx.fillText(`PONTOS: ${score}`, 20, 40);
      ctx.fillText(`VIDAS: ${'‚ù§Ô∏è'.repeat(lives)}`, 20, 70);
      ctx.fillText(`PODERES: ${powerUpLevel}`, 20, 100);
      ctx.fillText(`ESCUDOS: ${'üõ°Ô∏è'.repeat(shieldCount)}`, 20, 130);
      ctx.shadowBlur = 0;
      ctx.textAlign = 'left';

      rafIdGame = requestAnimationFrame(gameLoop);
    }

    function applyPowerUp(type) {
      const currentTime = Date.now();
      if (type === 'speed') {
        speedBoostEndTime = currentTime + 5000;
      } else if (type === 'shield') {
        shieldCount = Math.min(3, shieldCount + 1);
        shieldEndTime = currentTime + 5000;
        shieldActive = true;
      } else if (type === 'life') {
        lives = Math.min(5, lives + 1); // M√°ximo 5 vidas
      }
    }

    function endGame(forceResume = false) {
      gameActive = false;
      cancelAnimationFrame(rafIdGame);
      thrustSound.pause();
      thrustSound.currentTime = 0;
      isThrusting = false;
      rafIdStars = requestAnimationFrame(drawStars);
      rafIdParticles = requestAnimationFrame(updateParticles);
      logo.style.opacity = '1';
      if (!forceResume) {
        // Exibir score primeiro com anima√ß√£o
        gameOverOverlay.style.display = 'flex';
        gameOverOverlay.style.opacity = '0';
        setTimeout(() => {
          gameOverOverlay.style.opacity = '1';
          gameOverOverlay.classList.add('show');
          const scoreEl = gameOverOverlay.querySelector('.score');
          scoreEl.style.opacity = '0';
          scoreEl.style.transform = 'scale(0.5)';
          scoreEl.style.transition = 'all 0.8s cubic-bezier(0.25, 0.8, 0.25, 1)';
          scoreEl.textContent = score;
          setTimeout(() => {
            scoreEl.style.opacity = '1';
            scoreEl.style.transform = 'scale(1)';
          }, 100);
        }, 300);

        // Ap√≥s exibir score, anima√ß√£o para o Ranking TOP 5
        setTimeout(() => {
          fetchTop5(score);
        }, 2000);
      } else {
        gameOverOverlay.style.display = 'none';
        buttonContainer.style.display = 'flex'; // Mostrar apenas ao sair do jogo ap√≥s game over
        buttonContainer.style.opacity = '1';
      }
    }

    function restartGame() {
      gameOverOverlay.style.display = 'none';
      gameOverOverlay.classList.remove('show');
      document.getElementById('nameInput').style.display = 'none';
      document.getElementById('nameInput').innerHTML = ''; // Limpa o conte√∫do ao reiniciar
      document.getElementById('top5').classList.remove('animate-ranking');
      startGame();
    }

    function exitGame() {
      endGame(true);
      ambientSound.pause();
      ambientSound.currentTime = 0;
    }

    document.addEventListener('keydown', (e) => {
      if (e.key.toLowerCase() === 'g') {
        e.preventDefault();
        if (!gameActive) {
          startGame();
        }
      } else if (e.key === 'Escape' && gameActive) {
        endGame(true);
      } else if (gameActive) {
        keys[e.key] = true;
        if (e.key === ' ') e.preventDefault();
      }
    });

    document.addEventListener('keyup', (e) => {
      if (gameActive) {
        keys[e.key] = false;
      }
    });

    document.addEventListener('touchstart', (e) => {
      if (gameActive) {
        e.preventDefault();
        touchActive = true;
        updateShipPos(e.touches[0].clientX, e.touches[0].clientY);
      }
    }, { passive: false });

    document.addEventListener('touchmove', (e) => {
      if (gameActive && touchActive) {
        e.preventDefault();
        updateShipPos(e.touches[0].clientX, e.touches[0].clientY);
      }
    }, { passive: false });

    document.addEventListener('touchend', (e) => {
      if (gameActive) {
        touchActive = false;
        const now = Date.now();
        if (now - doubleClickTimer < 300) {
          shoot();
        }
        doubleClickTimer = now;
      }
    }, { passive: false });

    function updateShipPos(tx, ty) {
      shipX = Math.max(0, Math.min(canvas.width - shipWidth, tx - shipWidth / 2));
      shipY = Math.max(0, Math.min(canvas.height - shipHeight, ty - shipHeight / 2));
      // Atualizar rastro durante toque
      const exhaustX = shipX + shipWidth / 2;
      const exhaustY = shipY + shipHeight;
      rastro.style.left = `${exhaustX - 50}px`;
      rastro.style.top = `${exhaustY}px`;
      rastroCore.style.left = `${exhaustX - 10}px`;
      rastroCore.style.top = `${exhaustY}px`;
    }

    document.addEventListener('dblclick', (e) => {
      if (gameActive && powerUpLevel > 0) {
        e.preventDefault();
        shoot();
      }
    });

    // Removido o event listener de double-click no logo, agora √© single-click direto via onclick no HTML

    function triggerExitSequence() {
      logo.style.animation = 'zoomLogo 2s ease-in forwards';
      canvas.style.animation = 'cameraZoom 2s ease-in forwards';
      hyperdriveActive = true;
      stars.forEach(s => s.isHyper = Math.random() < 0.8);
      document.getElementById('hyperdrive').style.opacity = '0.6';
      buttonContainer.style.display = 'none';

      setTimeout(() => {
        document.querySelector('#text1').style.transition = 'opacity 1s ease-out, transform 1s ease-out';
        document.querySelector('#text2').style.transition = 'opacity 1s ease-out, transform 1s ease-out';
        document.querySelector('#text1').style.opacity = '0';
        document.querySelector('#text2').style.opacity = '0';
        document.querySelector('#text1').style.transform = 'translateY(30px)';
        document.querySelector('#text2').style.transform = 'translateY(30px)';
      }, 1000);

      setTimeout(() => {
        overlay.style.opacity = '0.5';
        setTimeout(() => {
          overlay.style.opacity = '1';
        }, 300);
      }, 2500);

      setTimeout(() => {
        window.open(
          'https://search.google.com/local/writereview?placeid=ChIJj8QLZ3VNz5QR6fyhf_lxpkM',
          '_blank'
        );
      }, 4000);
    }

    setTimeout(() => {
      const rect = logo.getBoundingClientRect();
      flare.style.left = `${rect.left + rect.width / 2 - 100}px`;
      flare.style.top = `${rect.top + rect.height / 2 - 100}px`;
      flare.style.animation = 'flareEffect 0.5s ease-out forwards';
    }, 1000);

    rafIdStars = requestAnimationFrame(drawStars);
    rafIdParticles = requestAnimationFrame(updateParticles);
  </script>
</body>
</html>