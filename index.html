<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>IndaiaFibra - Avalia√ß√£o</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    html, body {
      margin: 0;
      height: 100%;
      overflow: hidden;
      font-family: 'Poppins', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      background: black;
      color: white;
    }

    #spaceCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at center, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
      z-index: 0;
      transition: transform 8s cubic-bezier(0.2, 0.8, 0.2, 1);
    }

    .nebula {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 30%, rgba(100, 150, 255, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 70%, rgba(255, 100, 150, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 50% 10%, rgba(150, 100, 255, 0.2) 0%, transparent 60%);
      z-index: 1;
      opacity: 0.6;
      animation: nebulaPulse 20s ease-in-out infinite;
    }

    .hyperdrive {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        linear-gradient(to bottom, rgba(32, 41, 158, 0.6) 0%, rgba(255, 255, 255, 0.15) 50%, rgba(179, 14, 14, 0.95) 100%),
        repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.05) 10px, rgba(255,255,255,0.05) 20px);
      opacity: 0;
      z-index: 2;
      pointer-events: none;
      transition: opacity 0.5s ease-in;
    }

    img {
      width: 150px;
      transform: translateY(100vh) scale(0.7);
      animation: entradaLogo 3.5s cubic-bezier(0.25, 0.8, 0.25, 1) forwards;
      filter: drop-shadow(0 0 30px rgba(21, 94, 183, 1)) brightness(1.5) saturate(2.0) contrast(1.2);
      z-index: 5;
      position: relative;
    }

    .flare {
      position: absolute;
      width: 200px;
      height: 200px;
      background: 
        radial-gradient(circle, rgba(255, 255, 255, 0.9) 0%, rgba(255, 200, 100, 0.6) 30%, transparent 70%),
        radial-gradient(ellipse, rgba(100, 200, 255, 0.4) 0%, transparent 50%);
      opacity: 0;
      z-index: 4;
      animation: flareEffect 0.5s ease-out forwards;
      pointer-events: none;
      border-radius: 50%;
    }

    p {
      font-size: 1.6rem;
      margin: 10px 0;
      opacity: 0;
      z-index: 5;
      position: relative;
      letter-spacing: 2px;
      text-align: center;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
    }

    #text1 { animation: textoAparece 1.5s ease-out 2.5s forwards; }
    #text2 { animation: textoAparece 1.5s ease-out 3.9s forwards; font-size: 2rem; font-weight: 700; text-shadow: 0 0 20px rgba(21, 94, 183, 0.8); }

    .button-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      margin-top: 20px;
      opacity: 0;
      animation: textoAparece 1.5s ease-out 4.5s forwards;
      z-index: 5;
    }

    button {
      padding: 12px 24px;
      font-size: 1.2rem;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      background: linear-gradient(45deg, #155EB7, #0d47a1);
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(21, 94, 183, 0.3), inset 0 1px 0 rgba(255,255,255,0.2);
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      min-width: 200px;
      position: relative;
      overflow: hidden;
    }

    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    button:hover::before {
      left: 100%;
    }

    button:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 8px 25px rgba(21, 94, 183, 0.4), inset 0 1px 0 rgba(255,255,255,0.3);
    }

    button:active {
      transform: translateY(0) scale(0.98);
    }

    #evaluateButton {
      background: linear-gradient(45deg, #28a745, #20c997);
      box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
    }

    #evaluateButton:hover {
      box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
    }

    #playButton {
      display: none;
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(221, 221, 221, 1);
      opacity: 0;
      z-index: 10;
      pointer-events: none;
      transition: opacity 1s ease-in;
    }

    #gameOverOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at center, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.95) 100%),
        url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><radialGradient id="g" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="%23ff0000" stop-opacity="0.1"/><stop offset="100%" stop-color="%23ff0000" stop-opacity="0"/></radialGradient></defs><circle cx="50" cy="50" r="50" fill="url(%23g)"/></svg>') center/cover;
      z-index: 20;
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      color: white;
      font-family: 'Poppins', sans-serif;
      gap: 20px;
      text-align: center;
      padding: 20px;
    }

    #gameOverOverlay h2 {
      font-size: 2.5rem;
      margin: 0 0 10px;
      font-weight: 700;
      text-shadow: 0 0 20px rgba(255,0,0,0.8);
      letter-spacing: 2px;
    }

    #gameOverOverlay p {
      font-size: 1.8rem;
      margin: 0 0 20px;
      text-shadow: 0 0 10px rgba(255,255,255,0.5);
    }

    #gameOverOverlay button {
      padding: 12px 24px;
      font-size: 1.1rem;
      font-weight: 600;
      background: linear-gradient(45deg, #155EB7, #0d47a1);
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      margin: 0 5px;
      min-width: auto;
      box-shadow: 0 4px 15px rgba(21, 94, 183, 0.3);
      transition: all 0.3s ease;
    }

    #gameOverOverlay button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(21, 94, 183, 0.4);
    }

    #gameOverOverlay button:nth-child(3) {
      background: linear-gradient(45deg, #6c757d, #495057);
      box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
    }

    #gameOverOverlay button:nth-child(3):hover {
      box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
    }

    #gameOverOverlay button:nth-child(4) {
      background: linear-gradient(45deg, #28a745, #20c997);
      box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
    }

    #gameOverOverlay button:nth-child(4):hover {
      box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
    }

    @media (max-width: 768px) {
      .button-container {
        flex-direction: column;
        gap: 10px;
      }

      button {
        font-size: 1.4rem;
        padding: 15px 30px;
        min-width: 250px;
      }

      #playButton {
        display: block;
      }

      #gameOverOverlay button {
        font-size: 1.3rem;
        padding: 15px 30px;
        margin: 5px 0;
        width: 80%;
      }

      #gameOverOverlay {
        gap: 15px;
        padding: 10px;
      }

      #gameOverOverlay h2 {
        font-size: 2rem;
      }

      #gameOverOverlay p {
        font-size: 1.5rem;
      }
    }

    .rastro {
      position: absolute;
      width: 100px;
      height: 350px;
      background: linear-gradient(to top, rgba(255, 230, 100, 0), rgba(0, 139, 255, 0.8), rgba(255, 50, 50, 1));
      border-radius: 100px 100px 50px 50px;
      filter: blur(120px);
      z-index: 4;
      opacity: 0.9;
      animation: pulsoRastro 1s ease-in-out infinite;
    }

    .rastro-core {
      position: absolute;
      width: 20px;
      height: 300px;
      background: linear-gradient(to top, rgba(50, 194, 255, 0.79), rgba(255, 4, 4, 1));
      border-radius: 40px;
      filter: blur(40px);
      z-index: 4;
      opacity: 0.95;
      animation: pulsoRastroCore 0.5s ease-in-out infinite;
    }

    @keyframes entradaLogo {
      0% { transform: translateY(100vh) scale(0.7); opacity: 0; }
      40% { transform: translateY(30px) scale(1.3); opacity: 1; }
      60% { transform: translateY(-20px) scale(0.95); }
      100% { transform: translateY(0) scale(1); }
    }

    @keyframes textoAparece {
      0% { opacity: 0; transform: translateY(40px); filter: blur(8px); }
      50% { opacity: 0.8; transform: translateY(0); filter: blur(0); }
      100% { opacity: 1; transform: translateY(0); filter: blur(0); }
    }

    @keyframes zoomLogo {
      0% { transform: translateY(0) scale(1); filter: brightness(1.3); }
      100% { transform: translateY(-120vh) scale(0.25); filter: brightness(2.5) drop-shadow(0 0 70px rgba(255, 150, 50, 1)); }
    }

    @keyframes pulsoRastro {
      0% { opacity: 0.9; transform: scaleY(1) scaleX(1); }
      50% { opacity: 1; transform: scaleY(1.3) scaleX(0.8); }
      100% { opacity: 0.9; transform: scaleY(1) scaleX(1); }
    }

    @keyframes pulsoRastroCore {
      0% { opacity: 0.95; transform: scaleY(1); }
      50% { opacity: 1; transform: scaleY(1.25); }
      100% { opacity: 0.95; transform: scaleY(1); }
    }

    @keyframes cameraZoom {
      0% { transform: scale(1); }
      100% { transform: scale(2); }
    }

    @keyframes nebulaPulse {
      0% { opacity: 0.6; transform: scale(1) rotate(0deg); }
      25% { opacity: 0.7; transform: scale(1.02) rotate(1deg); }
      50% { opacity: 0.6; transform: scale(1) rotate(0deg); }
      75% { opacity: 0.65; transform: scale(1.01) rotate(-1deg); }
      100% { opacity: 0.6; transform: scale(1) rotate(0deg); }
    }

    @keyframes flareEffect {
      0% { opacity: 0.9; transform: scale(0.1) rotate(0deg); }
      50% { opacity: 0.5; transform: scale(1.2) rotate(180deg); }
      100% { opacity: 0; transform: scale(2) rotate(360deg); }
    }

    @keyframes flameFlicker {
      0%, 100% { transform: scale(1) rotate(-2deg); opacity: 0.8; }
      50% { transform: scale(1.2) rotate(2deg); opacity: 1; }
    }

    @keyframes powerUpPulse {
      0% { transform: scale(1); box-shadow: 0 0 10px rgba(0, 255, 255, 0.5); }
      50% { transform: scale(1.1); box-shadow: 0 0 20px rgba(0, 255, 255, 0.8); }
      100% { transform: scale(1); box-shadow: 0 0 10px rgba(0, 255, 255, 0.5); }
    }

    .powerup {
      position: absolute;
      border-radius: 50%;
      animation: powerUpPulse 2s ease-in-out infinite;
    }
  </style>
</head>
<body>
  <canvas id="spaceCanvas"></canvas>
  <div class="nebula"></div>
  <div class="hyperdrive" id="hyperdrive"></div>
  <div class="rastro" id="rastro"></div>
  <div class="rastro-core" id="rastroCore"></div>
  <div class="flare" id="flare"></div>
  <img id="logo" src="logo.png" alt="IndaiaFibra Logo">
  <p id="text1">Avalie nosso servi√ßo</p>
  <p id="text2">Obrigado!</p>
  <div class="button-container">
    <button id="playButton" onclick="startGame()">Jogar</button>
    <button id="evaluateButton" onclick="triggerExitSequence()">Avaliar Agora</button>
  </div>
  <div class="overlay" id="overlay"></div>
  <div id="gameOverOverlay">
    <h2>Game Over!</h2>
    <p><h1></h1> PONTUA√á√ÉO: </h1></h1><h1 class="score">0</h1></p>
    <button onclick="restartGame()">Jogar Novamente</button>
    <button onclick="exitGame()">Sair do Jogo</button>
    <button onclick="triggerExitSequence()">Avaliar Servi√ßo</button>
  </div>

  <audio id="ambientSound" src="/click-sound.mp3" autoplay loop volume="0.3"></audio>

  <script>
    const canvas = document.getElementById('spaceCanvas');
    const ctx = canvas.getContext('2d');
    const logo = document.getElementById('logo');
    const rastro = document.getElementById('rastro');
    const rastroCore = document.getElementById('rastroCore');
    const flare = document.getElementById('flare');
    const overlay = document.getElementById('overlay');
    const gameOverOverlay = document.getElementById('gameOverOverlay');
    const buttonContainer = document.querySelector('.button-container');
    const pageStartTime = Date.now();
    let rafIdStars, rafIdParticles, rafIdGame;
    let hyperdriveActive = false;
    let gameActive = false;
    let lastTime = 0;
    const shipImg = new Image();
    shipImg.src = 'logo.png';
    let shipX, shipY, shipWidth = 120, shipHeight = 120;
    let score = 0;
    let lives = 2;
    let gameStartTime;
    let keys = {};
    let asteroids = [];
    let powerups = [];
    let bullets = [];
    let thrustParticles = [];
    let explosionParticles = [];
    let asteroidFlames = [];
    let powerUpLevel = 0;
    let baseSpeed = 4;
    let currentSpeed = baseSpeed;
    let shieldActive = false;
    let shieldEndTime = 0;
    let speedBoostEndTime = 0;
    let touchActive = false;
    let doubleClickTimer = 0;
    let difficultyLevel = 0;
    let asteroidSpawnRate = 0.03;
    let maxAsteroidSpeed = 6;

    // Cores para o rastro baseadas no powerUpLevel
    const trailColors = {
      0: { fire: 'hsl(20, 100%, 50%)', smoke: 'hsl(20, 20%, 50%)' }, // Laranja para default, fuma√ßa marrom
      1: { fire: 'hsl(200, 100%, 50%)', smoke: 'hsl(200, 50%, 60%)' },
      2: { fire: 'hsl(60, 100%, 50%)', smoke: 'hsl(60, 50%, 70%)' },
      3: { fire: 'hsl(340, 100%, 50%)', smoke: 'hsl(340, 50%, 60%)' }
    };

    // Fun√ß√£o para vibra√ß√£o em dispositivos m√≥veis
    function vibrate(duration = 100) {
      if ('vibrate' in navigator && window.matchMedia('(pointer: coarse)').matches) {
        navigator.vibrate(duration);
      }
    }

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    const stars = Array.from({ length: 500 }, () => ({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      size: Math.random() * 2 + 0.3,
      speed: Math.random() * 1 + 0.2,
      brightness: Math.random() * 0.5 + 0.5,
      layer: Math.random() < 0.4 ? 'distant' : Math.random() < 0.6 ? 'mid' : 'near',
      isHyper: false
    }));

    function drawStars() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let s of stars) {
        ctx.fillStyle = s.layer === 'distant' ? '#888' : s.layer === 'mid' ? '#bbb' : '#fff';
        ctx.globalAlpha = s.brightness;
        if (hyperdriveActive && s.isHyper) {
          ctx.beginPath();
          ctx.moveTo(s.x, s.y);
          ctx.lineTo(s.x, s.y + s.size * 20);
          ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
          ctx.lineWidth = s.size * 2;
          ctx.lineCap = 'round';
          ctx.stroke();
          s.y += s.speed * 15;
        } else {
          ctx.beginPath();
          ctx.arc(s.x, s.y, s.layer === 'distant' ? s.size * 0.5 : s.layer === 'mid' ? s.size * 0.8 : s.size, 0, Math.PI * 2);
          ctx.fill();
          s.y += s.layer === 'distant' ? s.speed * 0.5 : s.layer === 'mid' ? s.speed * 0.8 : s.speed;
        }
        if (s.y > canvas.height) s.y = 0;
      }
      ctx.globalAlpha = 1;
      rafIdStars = requestAnimationFrame(drawStars);
    }

    const particles = [];
    function createParticle(x, y, isSmoke = false, customColor = null) {
      const color = customColor || (isSmoke ? `hsl(0, 0%, ${Math.random() * 20 + 50}%)` : `hsl(${Math.random() * 40 + 20}, 100%, ${Math.random() * 30 + 50}%)`);
      particles.push({
        x: x + (Math.random() * 50 - 25),
        y: y,
        alpha: 1,
        size: isSmoke ? Math.random() * 20 + 10 : Math.random() * 6 + 3,
        vx: isSmoke ? Math.random() * 2 - 1 : Math.random() * 4 - 2,
        vy: isSmoke ? Math.random() * 2 + 1 : Math.random() * 8 + 4,
        color: color,
        decay: isSmoke ? Math.random() * 0.01 + 0.005 : Math.random() * 0.03 + 0.02,
        rotation: Math.random() * Math.PI * 2,
        isSmoke
      });
    }

    function updateParticles() {
      const rect = logo.getBoundingClientRect();
      for (let i = 0; i < 3; i++) createParticle(rect.left + rect.width / 2, rect.bottom - 5);
      for (let i = 0; i < 2; i++) createParticle(rect.left + rect.width / 2, rect.bottom - 5, true);

      for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.alpha -= p.decay;
        p.size *= p.isSmoke ? 0.98 : 0.95;
        p.vy += 0.1;
        p.rotation += p.isSmoke ? 0.05 : 0.1;
        if (p.alpha <= 0 || p.size <= 0.1 || p.y > canvas.height) particles.splice(i, 1);
      }

      particles.forEach(p => {
        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rotation);
        ctx.fillStyle = p.color;
        ctx.globalAlpha = p.alpha;
        ctx.shadowColor = p.color;
        ctx.shadowBlur = 5;
        ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);
        if (!p.isSmoke && Math.random() < 0.2) {
          ctx.fillStyle = 'white';
          ctx.globalAlpha = p.alpha * 0.7;
          ctx.fillRect(-p.size / 4, -p.size / 4, p.size / 2, p.size / 2);
        }
        ctx.restore();
      });
      ctx.globalAlpha = 1;
      ctx.shadowBlur = 0;

      rastro.style.left = `${rect.left + rect.width / 2 - 25}px`;
      rastro.style.top = `${rect.bottom - 10}px`;
      rastroCore.style.left = `${rect.left + rect.width / 2 - 10}px`;
      rastroCore.style.top = `${rect.bottom - 5}px`;

      rafIdParticles = requestAnimationFrame(updateParticles);
    }

    // Fun√ß√£o para criar part√≠culas de thrust com cor baseada no powerUpLevel e fuma√ßa marrom
    function createThrustParticle(x, y) {
      const colors = trailColors[powerUpLevel] || trailColors[0];
      // Fogo
      for (let i = 0; i < 3; i++) {
        thrustParticles.push({
          x: x + Math.random() * 20 - 10,
          y: y + shipHeight,
          vx: (Math.random() - 0.5) * 5,
          vy: Math.random() * 4 + 3,
          size: Math.random() * 10 + 4,
          alpha: 1,
          color: colors.fire,
          decay: 0.04,
          life: 35,
          glow: true
        });
      }
      // Poeira/fuma√ßa marrom
      for (let i = 0; i < 4; i++) {
        thrustParticles.push({
          x: x + Math.random() * 20 - 10,
          y: y + shipHeight,
          vx: (Math.random() - 0.5) * 3,
          vy: Math.random() * 3 + 1.5,
          size: Math.random() * 8 + 3,
          alpha: 0.8,
          color: colors.smoke, // Marrom
          decay: 0.025,
          life: 45,
          trail: true
        });
      }
    }

    // Update thrust particles
    function updateThrustParticles() {
      for (let i = thrustParticles.length - 1; i >= 0; i--) {
        const p = thrustParticles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.15;
        p.alpha -= p.decay;
        p.size *= 0.97;
        p.life--;
        if (p.alpha <= 0 || p.life <= 0 || p.y > canvas.height) {
          thrustParticles.splice(i, 1);
        }
      }
    }

    // Draw thrust particles
    function drawThrustParticles() {
      thrustParticles.forEach(p => {
        ctx.save();
        if (p.glow) {
          ctx.shadowColor = p.color;
          ctx.shadowBlur = 10;
        }
        ctx.globalAlpha = p.alpha;
        ctx.fillStyle = p.color;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fill();
        if (p.trail && Math.random() < 0.3) {
          ctx.globalAlpha = p.alpha * 0.5;
          ctx.fillStyle = 'rgba(139, 69, 19, 0.3)'; // Marrom claro para trail
          ctx.beginPath();
          ctx.arc(p.x - p.vx * 2, p.y - p.vy * 2, p.size * 0.5, 0, Math.PI * 2);
          ctx.fill();
        }
        ctx.restore();
      });
      ctx.shadowBlur = 0;
    }

    // Part√≠culas de explos√£o marrom
    function createExplosion(x, y, count = 8) {
      for (let i = 0; i < count; i++) {
        explosionParticles.push({
          x: x,
          y: y,
          vx: (Math.random() - 0.5) * 10,
          vy: (Math.random() - 0.5) * 10,
          size: Math.random() * 6 + 3,
          alpha: 1,
          color: `hsl(20, 30%, ${Math.random() * 20 + 30}%)`, // Tons de marrom
          decay: 0.05,
          life: 30,
          glow: true
        });
      }
    }

    function updateExplosionParticles() {
      for (let i = explosionParticles.length - 1; i >= 0; i--) {
        const p = explosionParticles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.vx *= 0.98;
        p.vy *= 0.98;
        p.alpha -= p.decay;
        p.size *= 0.95;
        p.life--;
        if (p.alpha <= 0 || p.life <= 0) {
          explosionParticles.splice(i, 1);
        }
      }
    }

    function drawExplosionParticles() {
      explosionParticles.forEach(p => {
        ctx.save();
        ctx.shadowColor = p.color;
        ctx.shadowBlur = 8;
        ctx.globalAlpha = p.alpha;
        ctx.fillStyle = p.color;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
      });
      ctx.shadowBlur = 0;
    }

    // Chamas para asteroides
    function createAsteroidFlame(a) {
      if (!a.flames) a.flames = [];
      for (let i = 0; i < 3; i++) {
        a.flames.push({
          x: a.x + (Math.random() - 0.5) * a.size,
          y: a.y + a.size / 2,
          vx: (Math.random() - 0.5) * 2,
          vy: Math.random() * -2 - 1,
          size: Math.random() * 4 + 2,
          alpha: Math.random() * 0.5 + 0.5,
          color: `hsl(${20 + Math.random() * 40}, 100%, ${50 + Math.random() * 30}%)`,
          life: 20 + Math.random() * 10
        });
      }
    }

    function updateAsteroidFlames() {
      asteroids.forEach(a => {
        if (a.flames) {
          for (let i = a.flames.length - 1; i >= 0; i--) {
            const f = a.flames[i];
            f.x += f.vx;
            f.y += f.vy;
            f.vy += 0.1;
            f.alpha -= 0.05;
            f.life--;
            if (f.alpha <= 0 || f.life <= 0) {
              a.flames.splice(i, 1);
            }
          }
          if (Math.random() < 0.3) createAsteroidFlame(a); // Manter chamas vivas
        } else {
          createAsteroidFlame(a);
        }
      });
    }

    function drawAsteroidFlames() {
      asteroids.forEach(a => {
        if (a.flames) {
          a.flames.forEach(f => {
            ctx.save();
            ctx.globalAlpha = f.alpha;
            ctx.fillStyle = f.color;
            ctx.shadowColor = f.color;
            ctx.shadowBlur = 6;
            ctx.beginPath();
            ctx.ellipse(f.x, f.y, f.size, f.size * 1.5, 0, 0, Math.PI * 2); // Elipse para chama
            ctx.fill();
            ctx.restore();
          });
        }
      });
      ctx.shadowBlur = 0;
    }

    // Game functions
    function startGame() {
      if (gameActive) return;
      gameActive = true;
      // Remover completamente os bot√µes principais
      buttonContainer.style.display = 'none';
      logo.style.opacity = '0';
      document.querySelector('#text1').style.display = 'none';
      document.querySelector('#text2').style.display = 'none';
      rastro.style.opacity = '1';
      rastroCore.style.opacity = '0';
      flare.style.opacity = '0';
      cancelAnimationFrame(rafIdStars);
      cancelAnimationFrame(rafIdParticles);
      particles.length = 0;
      thrustParticles.length = 0;
      explosionParticles.length = 0;
      asteroidFlames = [];
      shipX = (canvas.width - shipWidth) / 2;
      shipY = canvas.height - shipHeight - 50;
      score = 0;
      lives = 0;
      asteroids = [];
      powerups = [];
      bullets = [];
      powerUpLevel = 0;
      gameStartTime = Date.now();
      lastDifficultyIncrease = gameStartTime;
      difficultyLevel = 0;
      asteroidSpawnRate = 0.01;
      maxAsteroidSpeed = 2;
      keys = {};
      currentSpeed = baseSpeed;
      shieldActive = false;
      speedBoostEndTime = 2;
      lastTime = performance.now();
      gameLoop(lastTime);
    }

    function gameLoop(currentTime) {
      if (!gameActive) {
        rafIdGame = requestAnimationFrame(gameLoop);
        return;
      }
      const deltaTime = (currentTime - lastTime) / 16.67;
      lastTime = currentTime;

      const gameTime = Date.now() - gameStartTime;
      const newLevel = Math.floor(gameTime / 10000);
      if (newLevel > difficultyLevel) {
        difficultyLevel = newLevel;
        asteroidSpawnRate += 0.005;
        maxAsteroidSpeed += 1;
      }

      if (Date.now() > speedBoostEndTime) currentSpeed = baseSpeed;
      else currentSpeed = baseSpeed * 1.5;
      if (Date.now() > shieldEndTime) shieldActive = false;

      let moving = false;
      const speed = currentSpeed * deltaTime * (window.innerWidth > 768 ? 1 : 0.8);
      if (keys['ArrowLeft'] || keys['a'] || keys['A']) {
        shipX = Math.max(0, shipX - speed);
        moving = true;
      }
      if (keys['ArrowRight'] || keys['d'] || keys['D']) {
        shipX = Math.min(canvas.width - shipWidth, shipX + speed);
        moving = true;
      }
      if (keys['ArrowUp'] || keys['w'] || keys['W']) {
        shipY = Math.max(0, shipY - speed);
        moving = true;
      }
      if (keys['ArrowDown'] || keys['s'] || keys['S']) {
        shipY = Math.min(canvas.height - shipHeight, shipY + speed);
        moving = true;
      }

      if (moving && Math.random() < 0.6) {
        createThrustParticle(shipX + shipWidth / 2, shipY + shipHeight);
      }

      if (keys[' '] && powerUpLevel > 0) {
        bullets.push({
          x: shipX + shipWidth / 2,
          y: shipY,
          vx: 0,
          vy: - (8 + powerUpLevel * 2),
          size: 2 + powerUpLevel * 2,
          color: powerUpLevel === 1 ? '#00ffff' : powerUpLevel === 2 ? '#ffff00' : '#ff0000'
        });
        keys[' '] = false;
      }

      for (let s of stars) {
        const layerSpeed = (s.layer === 'distant' ? s.speed * 0.5 : s.layer === 'mid' ? s.speed * 0.8 : s.speed) * 1.2 * deltaTime;
        s.y += layerSpeed;
        if (s.y > canvas.height) s.y = 0;
        const dx = s.x - (shipX + shipWidth / 2);
        const dy = s.y - (shipY + shipHeight / 2);
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < s.size + shipWidth / 4) {
          score += 10;
          s.x = Math.random() * canvas.width;
          s.y = -10;
        }
      }

      for (let i = bullets.length - 1; i >= 0; i--) {
        let b = bullets[i];
        b.y += b.vy * deltaTime;
        if (b.y < 0) {
          bullets.splice(i, 1);
          continue;
        }
        for (let j = asteroids.length - 1; j >= 0; j--) {
          let a = asteroids[j];
          const bdx = b.x - a.x;
          const bdy = b.y - a.y;
          const bdist = Math.sqrt(bdx * bdx + bdy * bdy);
          if (bdist < b.size + a.size) {
            score += 20;
            bullets.splice(i, 1);
            createExplosion(a.x, a.y, 12); // Explos√£o marrom
            vibrate(50); // Vibra√ß√£o no acerto
            asteroids.splice(j, 1);
            break;
          }
        }
      }

      for (let i = asteroids.length - 1; i >= 0; i--) {
        let a = asteroids[i];
        a.y += a.speed * deltaTime;
        if (a.y > canvas.height) {
          asteroids.splice(i, 1);
          continue;
        }
        const dx = a.x - (shipX + shipWidth / 2);
        const dy = a.y - (shipY + shipHeight / 2);
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < a.size + shipWidth / 4 && !shieldActive) {
          lives--;
          createExplosion(shipX + shipWidth / 2, shipY + shipHeight / 2, 15); // Explos√£o no impacto
          vibrate(200); // Vibra√ß√£o forte no impacto
          asteroids.splice(i, 1);
          if (lives <= 0) {
            endGame();
            return;
          }
        } else if (dist < a.size + shipWidth / 4 && shieldActive) {
          asteroids.splice(i, 1);
          createParticle(a.x, a.y, true, 'rgba(0,255,0,0.5)');
          vibrate(100); // Vibra√ß√£o no bloqueio de escudo
        }
      }

      for (let i = powerups.length - 1; i >= 0; i--) {
        let p = powerups[i];
        p.y += p.speed * deltaTime;
        if (p.y > canvas.height) {
          powerups.splice(i, 1);
          continue;
        }
        const dx = p.x - (shipX + shipWidth / 2);
        const dy = p.y - (shipY + shipHeight / 2);
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < p.size + shipWidth / 4) {
          powerUpLevel = Math.min(3, powerUpLevel + 1);
          applyPowerUp(p.type);
          powerups.splice(i, 1);
          vibrate(150); // Vibra√ß√£o no power-up
          for (let k = 0; k < 6; k++) {
            createParticle(p.x, p.y, false);
          }
        }
      }

      if (Math.random() < asteroidSpawnRate * deltaTime) {
        asteroids.push({
          x: Math.random() * canvas.width,
          y: 0,
          size: Math.random() * 20 + 15,
          speed: Math.random() * maxAsteroidSpeed + 3,
          flames: []
        });
      }

      if (Math.random() < 0.005 * deltaTime) {
        const types = ['speed', 'shield', 'life'];
        const type = types[Math.floor(Math.random() * types.length)];
        powerups.push({
          x: Math.random() * canvas.width,
          y: 0,
          size: 12,
          speed: Math.random() * 2 + 1,
          type: type
        });
      }

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      for (let s of stars) {
        ctx.fillStyle = s.layer === 'distant' ? '#888' : s.layer === 'mid' ? '#bbb' : '#fff';
        ctx.globalAlpha = s.brightness;
        const r = s.layer === 'distant' ? s.size * 0.5 : s.layer === 'mid' ? s.size * 0.8 : s.size;
        ctx.beginPath();
        ctx.arc(s.x, s.y, r, 0, Math.PI * 2);
        ctx.fill();
      }
      ctx.globalAlpha = 1;

      // Draw asteroid flames
      updateAsteroidFlames();
      drawAsteroidFlames();

      // Draw asteroids com emoji ü™® e chamas
      ctx.shadowColor = 'rgba(139, 69, 19, 0.8)';
      ctx.shadowBlur = 10;
      ctx.font = 'bold 20px Arial, sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      for (let a of asteroids) {
        ctx.font = `bold ${a.size * 1.2}px Arial, sans-serif`;
        ctx.fillStyle = '#8B4513';
        ctx.fillText('ü™®', a.x, a.y);
      }
      ctx.shadowBlur = 0;
      ctx.textAlign = 'left';
      ctx.textBaseline = 'alphabetic';

      bullets.forEach(b => {
        ctx.shadowColor = b.color;
        ctx.shadowBlur = 10;
        ctx.fillStyle = b.color;
        ctx.beginPath();
        ctx.rect(b.x - 2, b.y - 10, 4, 20);
        ctx.fill();
        ctx.beginPath();
        ctx.arc(b.x, b.y, b.size, 0, Math.PI * 2);
        ctx.fill();
        ctx.shadowBlur = 0;
      });

      // Draw powerups com √≠cones bonitos (emojis) e anima√ß√£o radial
      for (let p of powerups) {
        const pulseSize = p.size + Math.sin(Date.now() / 200) * 2;
        ctx.shadowColor = p.type === 'speed' ? '#00ffff' : p.type === 'shield' ? '#00ff00' : '#8000ff';
        ctx.shadowBlur = 12;
        ctx.fillStyle = p.type === 'speed' ? 'rgba(0, 255, 255, 0.9)' : p.type === 'shield' ? 'rgba(0, 255, 0, 0.9)' : 'rgba(128, 0, 255, 0.9)';
        ctx.beginPath();
        ctx.arc(p.x, p.y, pulseSize, 0, Math.PI * 2);
        ctx.fill();
        ctx.shadowBlur = 0;
        ctx.font = `${Math.min(16, canvas.width / 60)}px Arial, sans-serif`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        const icon = p.type === 'speed' ? 'üöÄ' : p.type === 'shield' ? 'üõ°Ô∏è' : '‚ù§Ô∏è';
        ctx.fillText(icon, p.x, p.y);
      }
      ctx.textAlign = 'left';
      ctx.textBaseline = 'alphabetic';

      drawThrustParticles();
      updateThrustParticles();

      updateExplosionParticles();
      drawExplosionParticles();

      ctx.shadowColor = shieldActive ? 'rgba(0, 255, 0, 1)' : 'rgba(21, 94, 183, 1)';
      ctx.shadowBlur = shieldActive ? 30 : 20;
      if (shipImg.complete) {
        ctx.drawImage(shipImg, shipX, shipY, shipWidth, shipHeight);
      }
      ctx.shadowBlur = 0;

      const uiScale = window.innerWidth > 768 ? 1 : 0.8;
      ctx.shadowColor = 'rgba(255, 255, 255, 0.5)';
      ctx.shadowBlur = 5;
      ctx.fillStyle = 'white';
      ctx.font = `bold ${Math.min(24, canvas.width / 30) * uiScale}px 'Poppins', sans-serif`;
      ctx.textAlign = 'left';
      ctx.fillText(`PONTOS: ${score}`, 20, 40);
      ctx.fillText(`VIDAS: ${'‚ù§Ô∏è'.repeat(lives)}`, 20, 70);
      ctx.fillText(`PODERES: ${powerUpLevel}`, 20, 100);
      if (shieldActive) {
        ctx.fillText('üõ°Ô∏è', 20, 130);
      }
      ctx.shadowBlur = 0;
      ctx.textAlign = 'left';

      rafIdGame = requestAnimationFrame(gameLoop);
    }

    function applyPowerUp(type) {
      const currentTime = Date.now();
      if (type === 'speed') {
        speedBoostEndTime = currentTime + 5000;
      } else if (type === 'shield') {
        shieldEndTime = currentTime + 5000;
        shieldActive = true;
      } else if (type === 'life') {
        lives++;
      }
    }

    function endGame(forceResume = false) {
      gameActive = false;
      cancelAnimationFrame(rafIdGame);
      rafIdStars = requestAnimationFrame(drawStars);
      rafIdParticles = requestAnimationFrame(updateParticles);
      logo.style.opacity = '1';
      rastro.style.opacity = '0.9';
      rastroCore.style.opacity = '0.95';
      if (!forceResume) {
        gameOverOverlay.querySelector('.score').textContent = score;
        gameOverOverlay.style.display = 'flex';
        // N√£o mostrar button-container no game over, s√≥ no exit
      } else {
        gameOverOverlay.style.display = 'none';
        buttonContainer.style.display = 'flex'; // Mostrar apenas ao sair do jogo ap√≥s game over
        buttonContainer.style.opacity = '1';
      }
    }

    function restartGame() {
      gameOverOverlay.style.display = 'none';
      startGame();
    }

    function exitGame() {
      endGame(true);
    }

    document.addEventListener('keydown', (e) => {
      if (e.key.toLowerCase() === 'g') {
        e.preventDefault();
        if (!gameActive) {
          startGame();
        }
      } else if (e.key === 'Escape' && gameActive) {
        endGame(true);
      } else if (gameActive) {
        keys[e.key] = true;
        if (e.key === ' ') e.preventDefault();
      }
    });

    document.addEventListener('keyup', (e) => {
      if (gameActive) {
        keys[e.key] = false;
      }
    });

    document.addEventListener('touchstart', (e) => {
      if (gameActive) {
        e.preventDefault();
        touchActive = true;
        updateShipPos(e.touches[0].clientX, e.touches[0].clientY);
      }
    }, { passive: false });

    document.addEventListener('touchmove', (e) => {
      if (gameActive && touchActive) {
        e.preventDefault();
        updateShipPos(e.touches[0].clientX, e.touches[0].clientY);
      }
    }, { passive: false });

    document.addEventListener('touchend', (e) => {
      if (gameActive) {
        touchActive = false;
        const now = Date.now();
        if (now - doubleClickTimer < 300) {
          shoot();
        }
        doubleClickTimer = now;
      }
    }, { passive: false });

    function updateShipPos(tx, ty) {
      shipX = Math.max(0, Math.min(canvas.width - shipWidth, tx - shipWidth / 2));
      shipY = Math.max(0, Math.min(canvas.height - shipHeight, ty - shipHeight / 2));
    }

    function shoot() {
      if (powerUpLevel > 0) {
        bullets.push({
          x: shipX + shipWidth / 2,
          y: shipY,
          vx: 0,
          vy: - (8 + powerUpLevel * 2),
          size: 2 + powerUpLevel * 2,
          color: powerUpLevel === 1 ? '#00ffff' : powerUpLevel === 2 ? '#ffff00' : '#ff0000'
        });
        vibrate(30); // Vibra√ß√£o leve no tiro
      }
    }

    document.addEventListener('dblclick', (e) => {
      if (gameActive && powerUpLevel > 0) {
        e.preventDefault();
        shoot();
      }
    });

    logo.addEventListener('click', (e) => {
      if (gameActive) return;
      const now = Date.now();
      if (now - doubleClickTimer < 300) {
        startGame();
      }
      doubleClickTimer = now;
    });

    function triggerExitSequence() {
      logo.style.animation = 'zoomLogo 2s ease-in forwards';
      canvas.style.animation = 'cameraZoom 2s ease-in forwards';
      hyperdriveActive = true;
      stars.forEach(s => s.isHyper = Math.random() < 0.8);
      document.getElementById('hyperdrive').style.opacity = '0.6';
      buttonContainer.style.display = 'none';

      setTimeout(() => {
        document.querySelector('#text1').style.transition = 'opacity 1s ease-out, transform 1s ease-out';
        document.querySelector('#text2').style.transition = 'opacity 1s ease-out, transform 1s ease-out';
        document.querySelector('#text1').style.opacity = '0';
        document.querySelector('#text2').style.opacity = '0';
        document.querySelector('#text1').style.transform = 'translateY(30px)';
        document.querySelector('#text2').style.transform = 'translateY(30px)';
      }, 1000);

      setTimeout(() => {
        overlay.style.opacity = '0.5';
        setTimeout(() => {
          overlay.style.opacity = '1';
        }, 300);
      }, 2500);

      setTimeout(() => {
  window.open(
    'https://search.google.com/local/writereview?placeid=ChIJj8QLZ3VNz5QR6fyhf_lxpkM',
    '_blank'
  );
}, 4000);
    }

    setTimeout(() => {
      const rect = logo.getBoundingClientRect();
      flare.style.left = `${rect.left + rect.width / 2 - 100}px`;
      flare.style.top = `${rect.top + rect.height / 2 - 100}px`;
      flare.style.animation = 'flareEffect 0.5s ease-out forwards';
    }, 1000);

    rafIdStars = requestAnimationFrame(drawStars);
    rafIdParticles = requestAnimationFrame(updateParticles);
  </script>
</body>
</html>